<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulCode - Spiritual Wellness App</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4c135d">
    <meta name="description" content="Your personal spiritual wellness companion with meditations, affirmations, and daily guidance">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
   <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;

}
/* UNIVERSAL PWA MOBILE CONTAINER - HIGHEST PRIORITY */
.page.active {
    max-width: 400px !important;
    margin: 0 auto !important;
    padding: 20px 15px 100px 15px !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
}

.page.active * {
    max-width: 100% !important;
    box-sizing: border-box !important;
}

.page.active img {
    max-width: 100% !important;
    height: auto !important;
    object-fit: contain !important;
}

.page.active .grid,
.page.active .categories-grid,
.page.active .quick-actions,
.page.active .calculators-grid {
    max-width: 100% !important;
    margin-left: auto !important;
    margin-right: auto !important;
}


body {
    font-family: 'Georgia', serif;
    background: linear-gradient(135deg, #350c48 0%, #2e0c3e 100%);
    color: white;
    min-height: 100vh;
    overflow-x: hidden;
}

#app {
    max-width: 400px;
    margin: 0 auto;
    min-height: 100vh;
    position: relative;
    padding-bottom: 80px;
}

.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #4c135d 0%, #350c48 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
}


.loading-content {
    text-align: center;
}

.loading-spinner {
    font-size: 60px;
    animation: pulse 2s infinite;
    margin-bottom: 20px;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
}

.page {
    display: none;
    padding: 20px;
    animation: fadeIn 0.3s ease;
}

.page.active {
    display: block;
}
#calculators-page {
    display: none !important;
}

#calculators-page.active {
    display: block !important;
}


@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
    margin-bottom: 30px;
}


.profile-circle:hover {
    transform: scale(1.1);
}

.welcome-text {
    font-size: 18px;
    font-weight: bold;
    color: #ccae79;
}

.page-header {
    text-align: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 28px;
    margin-bottom: 10px;
    color: #ccae79;
}

.page-header p {
    opacity: 0.8;
    font-size: 16px;
}

.card-section {
    text-align: center;
    margin-bottom: 40px;
}

.card-section h2 {
    color: #ccae79;
    margin-bottom: 20px;
    font-size: 24px;
}

.card-spinner {
    width: 200px;
    height: 280px;
    margin: 0 auto 20px;
    background: linear-gradient(45deg, #ccae79, #e6c896);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
}

.card-spinner:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 35px rgba(0,0,0,0.4);
}

.card-spinner.spinning {
    animation: cardSpin 3s ease-out;
}

@keyframes cardSpin {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg) scale(1.1); }
    100% { transform: rotateY(360deg); }
}

.card-content {
    text-align: center;
    color: #4c135d;
    font-weight: bold;
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 30px;
    max-width: 320px;
    margin-left: auto;
    margin-right: auto;
}


.action-card {
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 25px 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    backdrop-filter: blur(10px);
}

.action-card:hover {
    background: rgba(255,255,255,0.2);
    transform: translateY(-5px);
    border-color: #ccae79;
}

.action-icon {
    font-size: 40px;
    margin-bottom: 10px;
}

.action-title {
    font-weight: bold;
    color: #ccae79;
}
.action-card {
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.3s ease;
    user-select: none;
}

.action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.action-card:active {
    transform: translateY(0);
}

.quick-actions {
    pointer-events: auto;
}

.quick-actions .action-card {
    pointer-events: auto;
}


#access-code-input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin: 15px 0;
    box-sizing: border-box;
}


.btn {

    background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    margin: 10px 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    background: linear-gradient(135deg, #b8a06b 0%, #b49dd4 100%);
}

.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(76, 19, 93, 0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255,255,255,0.1);
    padding: 10px 0;
    z-index: 1000;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-around;
    align-items: center;
    max-width: 400px;
    margin: 0 auto;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 12px;
    transition: all 0.3s ease;
    min-width: 60px;
}

.nav-item:hover {
    background: rgba(255,255,255,0.1);
    transform: translateY(-2px);
}

.nav-item.active {
    background: rgba(204, 174, 121, 0.2);
    border: 1px solid #ccae79;
}

.nav-icon {
    font-size: 24px;
    margin-bottom: 4px;
    transition: transform 0.3s ease;
}

.nav-label {
    font-size: 11px;
    color: #ccae79;
    font-weight: bold;
    text-align: center;
}

.hidden {
    display: none !important;
}

@media (max-width: 480px) {
    #app {
        padding-bottom: 90px;
    }
    
    .page {
        padding: 15px;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .card-spinner {
        width: 160px;
        height: 220px;
    }
}
/* Add this to your CSS section */
.meditation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    padding: 20px;
}

.meditation-card {
    background: linear-gradient(135deg, #4c135d, #8b5a2b);
    border-radius: 15px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 15px rgba(76, 19, 93, 0.3);
}

.meditation-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(76, 19, 93, 0.5);
}

.meditation-image {
    position: relative;
    height: 200px;
    overflow: hidden;
}

.meditation-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(76, 19, 93, 0.4), rgba(139, 90, 43, 0.4));
}

.meditation-card h3 {
    color: #ccae79;
    padding: 15px;
    margin: 0;
    font-size: 1.1em;
}

.meditation-card p {
    color: #e6d7ff;
    padding: 0 15px 15px;
    margin: 0;
    font-size: 0.9em;
}
#meditation-player {
    display: none !important;
}

#meditation-player.active {
    display: block !important;
}
/* Beautiful Golden Meditation Player */
.meditation-player {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #1a0d1f, #2d1b3d);
    z-index: 1000;
    padding: 20px;
    overflow-y: auto;
}

.player-container {
    max-width: 500px;
    margin: 50px auto;
    background: linear-gradient(135deg, #4c135d, #8b5a2b);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(76, 19, 93, 0.5);
    text-align: center;
}

.player-image {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 0 auto 30px;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
    border: 4px solid #ccae79;
}

.player-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.play-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(76, 19, 93, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s ease;
}

.play-button {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #ccae79, #cdb2e3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    cursor: pointer;
    transition: transform 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
}

.play-button:hover {
    transform: scale(1.1);
}

.player-controls h3 {
    color: #ccae79;
    font-size: 1.5em;
    margin-bottom: 30px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.control-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.control-btn {
    background: linear-gradient(135deg, #ccae79, #cdb2e3);
    color: #4c135d;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    font-size: 1em;
}

.control-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
}

.control-btn:active {
    transform: translateY(0);
}

/* Modal for Arcana Selection */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: linear-gradient(135deg, #4c135d, #8b5a2b);
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
}

.close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 30px;
    color: #ccae79;
    cursor: pointer;
    font-weight: bold;
}

.close:hover {
    color: #cdb2e3;
}

.modal-content h2 {
    color: #ccae79;
    text-align: center;
    margin-bottom: 25px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.arcana-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.arcana-item {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 78, 0.1));
    border: 2px solid #ccae79;
    border-radius: 10px;
    padding: 15px;
    color: #ccae79;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-weight: bold;
}

.arcana-item:hover {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 237, 78, 0.2));
    transform: translateX(5px);
}
/* Update your existing categories-grid to ensure 3 per row */
.categories-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
    padding: 0 20px;
}

/* Add styles for the category images */
.category-image {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 15px;
    transition: transform 0.3s ease;
}

/* Update category card to accommodate images */
.category-card {
    position: relative;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-card:hover .category-image {
    transform: scale(1.05);
}

/* Selected state styling */
.category-card.selected {
    background: linear-gradient(135deg, #caafe0 0%, #ccae79 100%);
    color: white;
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.category-card.selected .category-image {
    border: 3px solid white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

/* Responsive design for mobile */
@media (max-width: 768px) {
    .categories-grid {
        grid-template-columns: 3fr;
        padding: 0 10px;
    }
}

@media (max-width: 1024px) and (min-width: 769px) {
    .categories-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
/* Category Selection Styles */
.category-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 15px;
    position: relative;
}

.category-card.selected {
    background-color: #caafe0 !important;
    border-color: #9b59b6;
    transform: scale(1.02);
}

.category-card .checkbox {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 20px;
    height: 20px;
    border: 2px solid #ddd;
    border-radius: 50%;
    background: white;
    transition: all 0.3s ease;
}

.category-card.selected .checkbox {
    background: #9b59b6;
    border-color: #9b59b6;
}

.category-card.selected .checkbox::after {
    content: '✓';
    color: white;
    font-size: 12px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Selected Categories Display */
.selected-categories {
    margin: 30px 0;
    padding: 20px;
    background:#ccae79;
    border-radius: 12px;
    display: none;
}

.selected-categories.show {
    display: block;
}

#selected-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.selected-tag {
    background: #caafe0;
    color: #333;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.selected-tag .remove {
    cursor: pointer;
    font-weight: bold;
    color: #666;
}

/* Notification Setup Styles */
.notification-setup {
    background:
    /* Additional styles for the new functionality */
.selected-categories {
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    display: none;
}

.selected-categories.show {
    display: block;
}

#selected-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.selected-tag {
    background: #caafe0;
    color: #333;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.selected-tag .remove {
    cursor: pointer;
    font-weight: bold;
    color: #666;
    font-size: 16px;
}

.selected-tag .remove:hover {
    color: #333;
}

/* Days selection */
.days-selection {
    margin: 20px 0;
}

.days-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.day-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 10px 15px;
    border: 2px solid #ddd;
    border-radius: 25px;
    transition: all 0.3s ease;
}

.day-checkbox input {
    display: none;
}

.day-checkbox span {
    font-weight: 500;
}

.day-checkbox:has(input:checked) {
    background: #caafe0;
    border-color: #9b59b6;
}

/* Frequency and time selection */
.frequency-selection,
.start-time-selection {
    margin: 20px 0;
}

#frequency-select,
#start-time {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 10px;
}

/* Save button */
.save-btn {
    background: linear-gradient(135deg, #caafe0 0%, #ccae79 100%);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s ease;
    margin: 20px 0;
}

.save-btn:hover {
    transform: translateY(-2px);
}

/* Schedule preview */
.schedule-preview {
    margin-top: 30px;
    padding: 20px;
    background: #e8f5e8;
    border-radius: 12px;
    display: none;
}

.schedule-preview h4 {
    color: #caafe0;
    margin-bottom: 15px;
}

#preview-content p {
    margin: 8px 0;
    color: #ccae79;
}

/* Success/Error messages */
.settings-message {
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    font-weight: 500;
}

.settings-message.success {
    background: #ccae79;
    color: #511c62;
    border: 1px solid #c3e6cb;
}

.settings-message.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* Category card selected state */
.category-card.selected {
    background-color: #caafe0 !important;
    border-color: #9b59b6 !important;
    transform: scale(1.02);
}

.category-card.selected .checkbox::after {
    content: '✓';
    color: white;
    font-size: 14px;
    font-weight: bold;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* Keep your existing categories-grid as is - 3 per row */
.categories-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
    padding: 0 20px;
}

/* Keep your existing category card styles */
.category-card {
    position: relative;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-card:hover .category-image {
    transform: scale(1.05);
}

/* Mobile responsive - replace all your @media rules with this */
@media (max-width: 768px) {
    .categories-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        padding: 0 10px;
    }
    
    .category-card {
        padding: 6px;
    }
    
    .category-image {
        height: 50px;
        margin-bottom: 6px;
    }
    
    .category-card h3 {
        font-size: 0.65rem;
        line-height: 1.1;
        margin: 0;
    }
}

@media (max-width: 480px) {
    .categories-grid {
        gap: 6px;
        padding: 0 8px;
    }
    
    .category-image {
        height: 40px;
        margin-bottom: 4px;
    }
    
    .category-card h3 {
        font-size: 0.6rem;
    }
}
    #affirmations-page .notification-setup {
    display: none !important;
}

#affirmations-page .notification-setup.show {
    display: block !important;
}
.days-selection,
.frequency-selection, 
.start-time-selection,
#save-settings,
#schedule-preview {
    display: none !important;
}

.days-selection.show,
.frequency-selection.show, 
.start-time-selection.show,
#save-settings.show,
#schedule-preview.show {
    display: block !important;
}
.embedded-calculator {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1000;
    display: none;
    padding: 20px;
    box-sizing: border-box;
}

.calculator-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
    margin-bottom: 20px;
}

.close-calculator {
    background: #ccae79;
    color: #4c135d;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
}

.calculator-iframe-container {
    background: white;
    border-radius: 10px;
    height: calc(100% - 80px);
}
/* Mobile-friendly calculator styles */
@media (max-width: 768px) {
    .calculators-grid {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 0 10px;
    }
    
    .calculator-card {
        margin-bottom: 20px;
    }
    
    .calculator-image img {
        height: 150px;
        object-fit: cover;
    }
    
    .calculator-buttons {
        flex-direction: column;
        gap: 10px;
    }
    
    .calculator-buttons .btn {
        width: 100%;
        padding: 12px;
        font-size: 14px;
    }
    
    /* Mobile-friendly embedded calculator */
    .embedded-calculator {
        padding: 10px;
    }
    
    .calculator-header h2 {
        font-size: 18px;
    }
    
    .close-calculator {
        width: 35px;
        height: 35px;
        font-size: 20px;
    }
    
    .calculator-iframe-container {
        height: calc(100vh - 100px);
    }
    
    .calculator-iframe-container iframe {
        height: 100%;
    }
    
    /* Code modal mobile */
    #code-modal .modal-content {
        width: 90%;
        margin: 20% auto;
        padding: 20px;
    }
.calculators-section {
    padding: 20px;
}

.calculators-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-top: 20px;
}

.calculator-card {
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
}

.calculator-title {
    color: #ccae79;
    font-size: 24px;
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
}

.calculator-image {
    position: relative;
    margin-bottom: 20px;
}

.calculator-image img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 15px;
}

.calculator-description {
    margin-bottom: 25px;
    line-height: 1.6;
}

.calculator-description p {
    margin-bottom: 15px;
    color: #e6d7ff;
}

.calculator-description strong {
    color: #ccae79;
}

.calculator-description ul {
    margin: 15px 0;
    padding-left: 20px;
}

.calculator-description li {
    margin-bottom: 8px;
    color: #e6d7ff;
}

.calculator-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

@media (max-width: 768px) {
    .calculators-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .calculator-title {
        font-size: 20px;
    }
.calculators-section {
    padding: 20px;
}

.calculators-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-top: 20px;
}

.calculator-card {
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
}

.calculator-title {
    color: #ccae79;
    font-size: 24px;
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
}

.calculator-image {
    position: relative;
    margin-bottom: 20px;
}

.calculator-image img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 15px;
}

.calculator-description {
    margin-bottom: 25px;
    line-height: 1.6;
}

.calculator-description p {
    margin-bottom: 15px;
    color: #e6d7ff;
}

.calculator-description strong {
    color: #ccae79;
}

.calculator-description ul {
    margin: 15px 0;
    padding-left: 20px;
}

.calculator-description li {
    margin-bottom: 8px;
    color: #e6d7ff;
}

.calculator-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

@media (max-width: 768px) {
    .calculators-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .calculator-title {
        font-size: 20px;
    }

.title-with-lock {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.lock-overlay {
    background: rgba(0,0,0,0.7);
    border-radius: 8px;
    padding: 4px 8px;
    display: flex;
    align-items: center;
    gap: 4px;
    position: static;
}

.lock-icon {
    font-size: 14px;
    color: white;
}

.unlock-text {
    font-size: 8px !important;
    color: white !important;
    margin: 0 !important;
    white-space: nowrap;
}

.modal-content button.btn {
  width: 48%;
  display: inline-block;
}


/* NUCLEAR OPTION - Maximum specificity */
html body #app #lifemap-page.page.active {
    position: relative !important;
    top: 0 !important;
    left: auto !important;
    width: 100% !important;
    height: auto !important;
    margin: 0 auto !important;
    padding: 20px 15px 100px 15px !important;
    padding-top: 0 !important;
    margin-top: 0 !important;
    background: linear-gradient(135deg, #4c135d 0%, #6b2c91 100%) !important;
    z-index: 9999 !important;
    overflow-y: auto !important;
    transform: none !important;
    max-width: 400px !important;
    box-sizing: border-box !important;
}


/* Force header to top */
html body #app #lifemap-page.page.active > * {
    margin-top: 0 !important;
    padding-top: 0 !important;
}

html body #app #lifemap-page.page.active > *:first-child {
    margin-top: 0 !important;
    padding-top: 20px !important;
}

/* Target all possible header classes */
html body #app #lifemap-page.page.active .page-header,
html body #app #lifemap-page.page.active .header,
html body #app #lifemap-page.page.active h1,
html body #app #lifemap-page.page.active h2 {
    padding: 20px 20px 10px 20px !important;
    margin: 0 !important;
    text-align: center !important;
    position: relative !important;
    top: 0 !important;
}

/* Target all possible content classes */
html body #app #lifemap-page.page.active .lifemap-content,
html body #app #lifemap-page.page.active .content,
html body #app #lifemap-page.page.active .page-content {
    padding: 0 20px 100px 20px !important;
    margin: 0 !important;
    text-align: center !important;
    min-height: auto !important;
    box-sizing: border-box !important;
}

/* Target all possible button classes */
html body #app #lifemap-page.page.active .lifemap-button,
html body #app #lifemap-page.page.active button,
html body #app #lifemap-page.page.active .btn,
html body #app #lifemap-page.page.active .button {
    margin: 30px 0 150px 0 !important;
    position: relative !important;
    z-index: 10000 !important;
    clear: both !important;
}



/* Mobile overrides */
@media screen and (max-width: 480px) {
    html body #app #lifemap-page.page.active {
        width: 100vw !important;
        left: 0 !important;
        transform: none !important;
    }
    
    html body #app #lifemap-page.page.active .page-header,
    html body #app #lifemap-page.page.active .header,
    html body #app #lifemap-page.page.active h1,
    html body #app #lifemap-page.page.active h2 {
        padding: 15px 15px 5px 15px !important;
        font-size: 24px !important;
    }
    
    html body #app #lifemap-page.page.active .lifemap-content,
    html body #app #lifemap-page.page.active .content,
    html body #app #lifemap-page.page.active .page-content {
        padding: 0 15px 350px 15px !important;
    }
}
* Force bottom nav to always be visible */
.bottom-nav {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Simple approach - just add lots of bottom padding to lifemap */
#lifemap-page.active {
    padding-bottom: 150px !important;
}

#lifemap-page.active button:last-child {
    margin-bottom: 200px !important;
}
.bottom-nav {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: #fff;
    border-top: 1px solid #e0e0e0;
    padding: 8px 0;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10000;
    pointer-events: auto;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    user-select: none;
}

.nav-item:hover {
    background-color: #f5f5f5;
    border-radius: 8px;
}

.nav-item.active {
    color: #6b2c91;
}

.nav-item.active .nav-icon {
    transform: scale(1.1);
}

.nav-icon {
    font-size: 20px;
    margin-bottom: 4px;
}

.nav-label {
    font-size: 12px;
    font-weight: 500;
}
/* Profile Settings Button */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    position: relative;
}

.profile-settings-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.profile-settings-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.settings-icon {
    font-size: 18px;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 20000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 0;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #eee;
    background: linear-gradient(135deg, #6b2c91 0%, #4c135d 100%);
    color: white;
    border-radius: 15px 15px 0 0;
}

.modal-header h2 {
    margin: 0;
    font-size: 24px;
}

.close-btn {
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    color: white;
    opacity: 0.8;
}

.close-btn:hover {
    opacity: 1;
}

.modal-body {
    padding: 20px;
}

/* Settings Sections */
.settings-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

.settings-section:last-child {
    border-bottom: none;
}

.settings-section h3 {
    margin: 0 0 15px 0;
    color: #6b2c91;
    font-size: 18px;
}


/* Progress Stats */
.progress-stats {
    display: flex;
    justify-content: space-around;
    gap: 20px;
}

.stat-item {
    text-align: center;
    flex: 1;
    padding: 15px;
    background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
    border-radius: 10px;
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #6b2c91;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Affirmation Settings */
.affirmation-settings {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.affirmation-item {
    padding: 15px;
    background: #f8f9ff;
    border-radius: 10px;
    border-left: 4px solid #6b2c91;
}

.affirmation-category {
    font-weight: bold;
    color: #6b2c91;
    margin-bottom: 5px;
}

.affirmation-text {
    color: #333;
    margin-bottom: 8px;
    font-style: italic;
}

.affirmation-schedule {
    font-size: 12px;
    color: #666;
    display: flex;
    align-items: center;
    gap: 5px;
}

.no-affirmations {
    text-align: center;
    padding: 20px;
    color: #666;
    font-style: italic;
}
.quick-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 100%;
}

.action-image {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.action-image img {
    width: 35px;
    height: 35px;
    object-fit: cover;
}
/* HOME PAGE CENTER ALIGNMENT AND MOBILE FIXES - HIGH SPECIFICITY */
body #app #home-page.page.active {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    padding: 20px 15px 100px 15px !important;
    max-width: 400px !important;
    margin: 0 auto !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
}

body #app #home-page.page.active .header {
    width: 100% !important;
    max-width: 360px !important;
}

body #app #home-page.page.active .card-section {
    width: 100% !important;
    max-width: 320px !important;
}

body #app #home-page.page.active .quick-actions {
    width: 100% !important;
    max-width: 320px !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 10px !important;
    margin: 20px 0 !important;
    padding: 0 !important;
}

body #app #home-page.page.active .action-card {
    padding: 8px 4px !important;
    min-height: 80px !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    align-items: center !important;
    margin: 0 !important;
    overflow: hidden !important;
}

body #app #home-page.page.active .action-image {
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    margin-bottom: 5px !important;
}

body #app #home-page.page.active .action-image img {
    width: 50px !important;
    height: 50px !important;
    object-fit: contain !important;
}
/* Profile Circle & Menu */
.profile-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
}

.profile-circle:hover {
    transform: scale(1.05);
}

.profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-menu.hidden {
    display: none;
}

.profile-menu-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 30px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.profile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    color: white;
}

.close-menu {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
}

.menu-item {
    display: flex !important;
    align-items: center !important;
    padding: 15px !important;
    margin: 10px 0 !important;
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 12px !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    color: white !important;
    user-select: none !important;
}

.menu-item:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: translateX(5px) !important;
}

.menu-icon {
    font-size: 20px !important;
    margin-right: 15px !important;
    width: 30px !important;
    pointer-events: none !important;
}


/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1001;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal.hidden {
    display: none;
}

.modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    text-align: center;
    margin-bottom: 25px;
}

.close-modal {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
}

/* Wishes Modal */
#wishes-text {
    width: 100%;
    min-height: 200px;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 12px;
    font-size: 16px;
    font-family: inherit;
    resize: vertical;
    margin-bottom: 20px;
}

.modal-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.modal-actions button {
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
}

.modal-actions button:first-child {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.modal-actions button:last-child {
    background: #f0f0f0;
    color: #333;
}
.profile-circle {
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    overflow: hidden !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
}

.profile-circle img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    border-radius: 50% !important;
}

#profile-image {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    border-radius: 50% !important;
}


/* Wishes List */
.wishes-list {
    max-height: 400px;
    overflow-y: auto;
}

.wish-item {
    padding: 15px;
    margin: 10px 0;
    background: #f8f9fa;
    border-radius: 12px;
    border-left: 4px solid #667eea;
}

.wish-date {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
}

.wish-text {
    font-size: 14px;
    line-height: 1.5;
}

/* Notification Settings */
.notification-settings h4 {
    margin: 20px 0 10px 0;
    color: #333;
}

.progress-stats {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 12px;
    margin: 15px 0;
}

.progress-stats p {
    margin: 8px 0;
    display: flex;
    justify-content: space-between;
}

.category-tag {
    display: inline-block;
    background: #667eea;
    color: white;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 12px;
    margin: 5px;
}

/* Success Message */
.success-message {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 15px 25px;
    border-radius: 25px;
    z-index: 1002;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

/* Responsive */
@media (max-width: 480px) {
    .profile-menu-content {
        padding: 20px;
        margin: 20px;
    }
    
    .modal-content {
        padding: 20px;
        margin: 20px;
    }


/* Category Selection Styles */
.category-card {
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.category-card.selected {
    border-color: #667eea;
    transform: scale(1.02);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.checkbox {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 20px;
    height: 20px;
    border: 2px solid #ddd;
    border-radius: 50%;
    background: white;
    transition: all 0.3s ease;
}

.checkbox.checked {
    background: #667eea;
    border-color: #667eea;
}

.checkbox.checked::after {
    content: '✓';
    color: white;
    font-size: 12px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.selected-category {
    display: inline-block;
    background: #667eea;
    color: white;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 12px;
    margin: 5px;
}

.preview-item {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.preview-item:last-child {
    border-bottom: none;
}
.profile-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #667eea;
}

.profile-circle:hover {
    transform: scale(1.05);
}

.profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}

/* Default emoji when no image */
.profile-circle .default-avatar {
    font-size: 24px;
    color: white;
}

.profile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-menu.hidden {
    display: none;
}

.profile-menu-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.profile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    color: #333;
}

.close-menu {
    background: none;
    border: none;
    color: #666;
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-menu:hover {
    background: #f0f0f0;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 15px;
    margin: 10px 0;
    background: #f8f9fa;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #333;
    border: 1px solid #e9ecef;
}

.menu-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}
/* Notification Toggle Styles */
.notification-toggle-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
}

.toggle-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 10px;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #667eea;
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

#notification-status {
    font-size: 14px;
    color: #666;
    flex: 1;
}

.divider {
    height: 1px;
    background: #e9ecef;
    margin: 20px 0;
}

.action-btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.action-btn:hover {
    background: #5a67d8;
    transform: translateY(-1px);
}
/* FORCE CIRCULAR PROFILE - FINAL FIX */
.profile-circle {
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    overflow: hidden !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.profile-circle img,
#profile-image {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    border-radius: 50% !important;
    display: block !important;
}
.profile-menu-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

#wishes-modal .modal-content {
    max-width: 600px !important;
    width: 95% !important;
    min-height: 500px !important;
}

#wishes-text {
    width: 100% !important;
    min-height: 300px !important;
    padding: 20px !important;
    font-size: 16px !important;
    border: 2px solid #ddd !important;
    border-radius: 12px !important;
    margin: 20px 0 !important;
    box-sizing: border-box !important;
}

.modal-actions {
    display: flex !important;
    gap: 15px !important;
    margin-top: 20px !important;
}

.modal-actions .btn {
    flex: 1 !important;
    margin: 0 !important;
}
#profile-menu {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 400px; /* Match your app's max width */
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
}

#profile-menu .modal-content {
    background: white;
    border-radius: 20px;
    padding: 20px;
    width: 100%;
    max-width: 350px; /* Slightly smaller than container */
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

#profile-modal .modal-content {
    max-width: 360px !important;
    width: 90% !important;
    margin: 0 auto !important;
}

#wishes-modal .modal-content {
    max-width: 380px !important;
    width: 90% !important;
    margin: 0 auto !important;
}

#wishes-text {
    width: 100% !important;
    box-sizing: border-box !important;
}

#profile-menu .modal-content,
#wishes-modal .modal-content {
  max-width: 400px !important; /* Limit to app-safe width */
  width: 90vw !important;      /* Responsive for all screens */
  margin: 0 auto;              /* Center horizontally */
  box-sizing: border-box;
}

#wishes-modal textarea {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  resize: vertical;
  padding: 10px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

.modal-content {
  box-sizing: border-box;
}
.modal-content {
    outline: 2px solid limegreen; /* Visual debugging */
  }
  #wishes-modal textarea {
    outline: 2px solid orange;
  }
  
  .message {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 99999 !important;
    background: #4CAF50 !important;
    color: white !important;
    padding: 20px 30px !important;
    border-radius: 12px !important;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4) !important;
    font-size: 16px !important;
    font-weight: bold !important;
    text-align: center !important;
    min-width: 300px !important;
}

@media (max-width: 768px) {
    .menu-item {
        min-height: 44px;
        padding: 15px 10px;
        margin: 8px 0;
    }
    .menu-item {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}

/* iOS-specific fix */
.menu-item {
    cursor: pointer;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

.spacer-2rem {
    margin: 2rem 0;
}



    #recent-affirmations-modal {
        width: 90% !important;
        max-width: 90% !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
    }
}


</style>

<!-- Authentication Screen -->
<div id="auth-screen" style="display: block;">
  <div style="max-width: 350px; margin: 100px auto; padding: 30px; text-align: center; background: rgba(255,255,255,0.1); border-radius: 20px; backdrop-filter: blur(10px);">
    <h1 style="color: #ccae79; margin-bottom: 10px;">Welcome to SoulCode</h1>
    <p style="color: rgba(255,255,255,0.8); margin-bottom: 30px;">Download the app now and get instant access to meditations, daily affirmations delivered straight to your phone, push notifications, powerful numerology calculators, free resources, and much more — all available in one place. </p>
    <!-- Install App Section -->
<div id="install-app-section" style="margin: 20px 0;">
  <button id="install-app-btn" class="btn" style="background: linear-gradient(135deg, #350c48 0%, #ccae79 100%); margin-bottom: 15px;" onclick="handleInstallApp()">
     Install App 
  </button>
</div>

<!-- Install Help Modal -->
<div id="install-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(5px);">
  <div style="max-width: 400px; margin: 50px auto; padding: 30px; background: rgba(53, 12, 72, 0.95); border-radius: 20px; color: white; position: relative; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);">
    <!-- Close Button -->
    <button onclick="closeInstallModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
      ✕
    </button>
    
    <h3 style="margin-top: 0; text-align: center; color: #ccae79;">Install SoulCode App</h3>
    
    <div id="install-instructions">
      <!-- Instructions will be populated by JavaScript -->
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button onclick="showInstallHelp()" class="btn" style="background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%); width: auto; padding: 10px 20px; font-size: 14px;">
        📖 I Need Help
      </button>
    </div>
  </div>
</div>

<!-- Help Image Modal -->
<div id="help-image-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1001; backdrop-filter: blur(5px);">
  <div style="max-width: 90%; max-height: 90%; margin: 5% auto; position: relative; text-align: center;">
    <button onclick="closeHelpModal()" style="position: absolute; top: -40px; right: 0; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; backdrop-filter: blur(10px);">
      ✕
    </button>
    <img id="help-screenshot" src="https://i.imgur.com/BF4JXyY.png" alt="Installation Help" style="max-width: 100%; max-height: 100%; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
  </div>
</div>

<script>
    let userAgent = navigator.userAgent.toLowerCase();

function handleInstallApp() {
  if (window.deferredPrompt || deferredPrompt) {
    // Use whichever deferredPrompt exists
    const prompt = window.deferredPrompt || deferredPrompt;
    prompt.prompt();
    prompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install prompt');
      }
    });
  } else {
    showInstallModal();
  }
}


function showInstallModal() {
  const modal = document.getElementById('install-modal');
  const instructions = document.getElementById('install-instructions');
  
  let instructionText = '';
  
  if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
  instructionText = `
    <div style="text-align: left; line-height: 1.6;">
      <p><strong>To install SoulCode manually:</strong></p>
      <br>
      <p><strong>🍎 On iOS (Safari):</strong> Tap the Share button (🔗) > 'Add to Home Screen'.</p>
    </div>
  `;
} else if (userAgent.includes('android')) {
  instructionText = `
    <div style="text-align: left; line-height: 1.6;">
      <p><strong>To install SoulCode manually:</strong></p>
      <br>
      <p><strong>📱 On Android (Chrome):</strong> Tap the browser menu (⋮) > 'Add to Home screen'.</p>
    </div>
  `;
} else {
  instructionText = `
    <div style="text-align: left; line-height: 1.6;">
      <p><strong>To install SoulCode manually:</strong></p>
      <br>
      <p><strong>📱 On Android (Chrome):</strong> Tap the browser menu (⋮) > 'Add to Home screen'.</p>
      <p><strong>🍎 On iOS (Safari):</strong> Tap the Share button (🔗) > 'Add to Home Screen'.</p>
    </div>
  `;
}

  
  instructions.innerHTML = instructionText;
  modal.style.display = 'block';
}

function closeInstallModal() {
  document.getElementById('install-modal').style.display = 'none';
}

function showInstallHelp() {
  document.getElementById('help-image-modal').style.display = 'block';
}

function closeHelpModal() {
  document.getElementById('help-image-modal').style.display = 'none';
}

// Close modals when clicking outside
document.getElementById('install-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeInstallModal();
  }
});

document.getElementById('help-image-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeHelpModal();
  }
});

</script>

        
    <!-- Social Login Icons -->
    <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">
      <svg width="40" height="40" viewBox="0 0 24 24" style="cursor: pointer; transition: transform 0.2s;"
            onmouseover="this.style.transform='scale(1.1)'"
            onmouseout="this.style.transform='scale(1)'"
           onclick="signInWithGoogle()">
        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
      </svg>
        
      <svg width="40" height="40" viewBox="0 0 24 24" style="cursor: pointer; transition: transform 0.2s;"
            onmouseover="this.style.transform='scale(1.1)'"
            onmouseout="this.style.transform='scale(1)'"
           onclick="signInWithApple()">
        <path fill="#ffffff" d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/> 
      </svg>
    </div>

    <div style="margin: 20px 0; color: rgba(255,255,255,0.6);">or</div>

    <!-- Two Separate Buttons -->
    <button class="btn" onclick="handleReturningUser()">
      Returning User
    </button>
    
    <button class="btn" onclick="handleNewUser()">
      New User
    </button>
  </div>
</div>

    
    
    <div id="main-app" style="display: none;">
    <div id="app">
        <!-- HOME PAGE -->
        <div id="home-page" class="page active">
            <div class="header">
                <div class="profile-circle" onclick="toggleProfileMenu()" style="width: 60px; height: 60px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <img id="profile-image" src="https://i.imgur.com/kT5du7E.png" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;" />
                </div>
                
        <div class="welcome-text"> Welcome Home, Soul Seeker</div>
    </div>

    <!-- Profile Menu Modal -->
<div id="profile-menu" class="modal hidden" style="position: fixed !important; left: 50% !important; transform: translateX(-50%) !important; width: 400px !important; max-width: 400px !important;">

        <div class="modal-content">
        <div class="modal-header">
            <h2>Profile Menu</h2>
            <span class="close-btn" onclick="closeProfileMenu()" style="position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #fff;">&times;</span>

        </div>
        <div class="modal-body">
            <div class="menu-item" onclick="changeProfilePicture()" style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; color: white;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateX(5px)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateX(0)'">

    <span class="menu-icon">📷</span>
    <span>Change Profile Picture</span>
</div>
<div class="menu-item" onclick="openWishesModal()" style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; color: white;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateX(5px)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateX(0)'">
🌟</span>
    <span>Write and Save Wishes & Desires</span>
</div>
<div class="menu-item" onclick="showNotificationModal()" style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; color: white;" onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateX(5px)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateX(0)'">
🔔</span>
    <span>Notification Settings</span>
</div>

<button class="menu-item" id="recent-affirmations-btn" 
     onclick="openRecentAffirmations()" 
     style="display: flex; align-items: center; padding: 15px; margin: 10px 0; background: rgba(255, 255, 255, 0.1); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; color: white; width: 100%; border: none; -webkit-appearance: none;" 
     onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateX(5px)'" 
     onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateX(0)'">
    <span class="menu-icon">📋</span>
    <span>Recent Affirmations</span>
</button>



        </div>
    </div>
</div>
    <!-- Wishes Whiteboard Modal -->
<div id="wishes-modal" class="modal hidden" style="position: fixed !important; left: 50% !important; transform: translateX(-50%) !important; width: 400px !important; max-width: 400px !important;">

    <div class="modal-content">
        <div class="modal-header">
            <h3>✨ Write Your Wishes & Desires</h3>
            <p>Now is the best time to write your wish down. Write it here and we'll keep it safe.</p>
            <button class="close-modal" onclick="closeWishesModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #fff;">×</button>

        </div>
        <textarea id="wishes-text" placeholder="Write your deepest desires and wishes here..."></textarea>
        <div class="modal-actions">
            <button class="btn" onclick="saveWish()">Save Wish</button>
            <button class="btn" onclick="viewSavedWishes()">View Saved Wishes</button>
        </div>
    </div>
    </div>
    
    <!-- Recent Affirmations Modal -->
<div id="recent-affirmations-modal" class="modal hidden" style="position: fixed !important; left: 50% !important; transform: translateX(-50%) !important; width: 450px !important; max-width: 450px !important;">
    <div class="modal-content" style="background: linear-gradient(135deg, #ccae79 0%, #5a1a6b 50%, #caafe0 100%); border: 1px solid rgba(204, 174, 121, 0.3);">
        <div class="modal-header" style="background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%); color: #350c48; border-radius: 15px 15px 0 0;">
            <h3 style="margin: 0; font-weight: bold;">📋 Recent Affirmations</h3>
            <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.8;">Last 12 hours of sent affirmations</p>
           <button class="close-modal" id="close-modal-btn" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #350c48; font-weight: bold;">×</button>


        </div>
        
        <div class="modal-body" style="max-height: 400px; overflow-y: auto; padding: 20px;">
            <!-- Loading state -->
            <div id="affirmations-loading" style="text-align: center; color: #ccae79; padding: 40px;">
                <div style="font-size: 24px; margin-bottom: 10px;">⏳</div>
                <p>Loading your recent affirmations...</p>
            </div>
            
            <!-- No affirmations state -->
            <div id="no-affirmations" style="display: none; text-align: center; color: rgba(255,255,255,0.7); padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 15px;">✨</div>
                <p>No affirmations in the last 12 hours</p>
                <p style="font-size: 14px; opacity: 0.8;">Check your notification schedule settings</p>
            </div>
            
            <!-- Affirmations list -->
            <div id="affirmations-list" style="display: none;">
                <!-- Affirmations will be populated here -->
            </div>
        </div>
        
        <div class="modal-footer" style="padding: 15px 20px; background: rgba(204, 174, 121, 0.1); border-radius: 0 0 15px 15px; text-align: center;">
            <button id="refresh-affirmations-btn" style="background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%); color: #350c48; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                   🔄 Refresh
            </button>
        </div>
    </div>
</div>

    <div class="card-section">
        <h2>Card of the Day</h2>
        <h5>Set an intention or ask a question you'd like clarity on.</h5>
        <div class="card-spinner" onclick="spinCard()">
            <div class="card-content">
                <div class="card-image">
                    <img src="https://i.imgur.com/gtt7sBW.png" alt="Mystical Cards" />
                </div>
                <p>Tap Here</p>
            </div>
        </div>
        <div id="card-result"></div>
    </div>
  <div class="quick-actions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; justify-content: center; padding: 0 10px; max-width: 100%; box-sizing: border-box;">
    <div class="action-card" data-page="meditations" style="width: 100%; max-width: 160px; justify-self: center; box-sizing: border-box;">
        <div class="action-image" style="height: 140px;">
            <img src="https://i.imgur.com/jgzqQji.png" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="action-title" style="padding: 18px; margin-top: 5px; text-align: center;">Meditations</div>
    </div>
    
    <div class="action-card" data-page="affirmations" style="width: 100%; max-width: 160px; justify-self: center; box-sizing: border-box;">
        <div class="action-image" style="height: 140px;">
            <img src="https://i.imgur.com/WYN9CEQ.png" alt="Affirmations" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="action-title" style="padding: 18px; margin-top: 5px; text-align: center;">Affirmations</div>
    </div>
    
    <div class="action-card" data-page="calculators" style="width: 100%; max-width: 160px; justify-self: center; box-sizing: border-box;">
        <div class="action-image" style="height: 140px;">
            <img src="https://i.imgur.com/nhX7zTJ.png" alt="Calculators" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="action-title" style="padding: 18px; margin-top: 5px; text-align: center;">Calculators</div>
    </div>
    
    <div class="action-card" data-page="lifemap" style="width: 100%; max-width: 160px; justify-self: center; box-sizing: border-box;">
        <div class="action-image" style="height: 140px;">
            <img src="https://i.imgur.com/4SYPpLZ.png" alt="Life Energy" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="action-title" style="padding: 18px; margin-top: 5px; text-align: center;">Life Energy</div>
    </div>
    
    <!-- Free Resources Card - KEPT EXACTLY AS YOU HAD IT -->
   <div class="action-card" onclick="openFreeResources()" style="width: 150px; max-width: 150px; grid-column: span 2; justify-self: center; margin-top: 20px;">
    <div class="action-image" style="height: 150px;">
        <img src="https://i.imgur.com/4SYPpLZ.png" alt="Free Resources" style="width: 100%; height: 100%; object-fit: cover;" />
    </div>
    <div class="action-title" style="font-size: 16px; padding: 12px; text-align: center;">Free Resources</div>
</div>
    </div>
</div>



       <!-- MEDITATIONS PAGE -->
<div id="meditations-page" class="page">
    <div class="page-header">
        <h1> Guided Meditations</h1>
        <p>Find your inner peace with this guided neural practices</p>
    </div>
    
    <div class="meditation-grid">
         <div class="meditation-card" data-meditation="personalized" onclick="showArcanaSelection()">
            <div class="meditation-image">
                <img src="https://i.imgur.com/yibBjxT.jpeg" alt="Personalized Meditations">
                <div class="image-overlay"></div>
            </div>
            <h3>Personalized Meditations</h3>
            <p>Based on your birth arcana</p>
        </div>
        
        <div class="meditation-card" data-meditation="stress">
            <div class="meditation-image">
                <img src="https://i.imgur.com/ta2QosF.jpeg" alt="Stress Relief">
                <div class="image-overlay"></div>
            </div>
            <h3>Stress Relief Neural Practice</h3>
            <p>Release tension and find calm</p>
        </div>
        <div class="meditation-card" data-meditation="breath">
            <div class="meditation-image">
                <img src="https://i.imgur.com/nezmJQ1.jpeg" alt="Breathing Technique">
                <div class="image-overlay"></div>
            </div>
            <h3>3 Deep Breath Technique</h3>
            <p>Alleviate stress with breathing</p>
        </div>
        
        <div class="meditation-card" data-meditation="depression">
            <div class="meditation-image">
                <img src="https://i.imgur.com/IQs6ZfI.jpeg" alt="Mental Wellness">
                <div class="image-overlay"></div>
            </div>
            <h3>Relieve Depression & Anxiety</h3>
            <p>Neural practice for mental wellness</p>
        </div>
        
        <div class="meditation-card" data-meditation="mindfulness">
            <div class="meditation-image">
                <img src="https://i.imgur.com/UwOlv9r.jpeg" alt="Mindfulness">
                <div class="image-overlay"></div>
            </div>
            <h3>Mindfulness Relaxation Guided</h3>
            <p>Neural practice for awareness</p>
        </div>
        
       
    </div>
    
    <!-- Meditation Player -->
    <div id="meditation-player" class="meditation-player" style="display: none;">
        <!-- Player content will be inserted here -->
    </div>
    
    <!-- Arcana Selection Modal -->
    <div id="arcana-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeArcanaModal()">&times;</span>
            <h2>🔮 Choose Your Birth Arcana</h2>
            <div class="arcana-list">
                <div class="arcana-item" onclick="startArcanaMediation(1)">1st Arcana - The Magician</div>
                <div class="arcana-item" onclick="startArcanaMediation(2)">2nd Arcana - The High Priestess</div>
                <div class="arcana-item" onclick="startArcanaMediation(3)">3rd Arcana - The Empress</div>
                <div class="arcana-item" onclick="startArcanaMediation(4)">4th Arcana - The Emperor</div>
                <div class="arcana-item" onclick="startArcanaMediation(5)">5th Arcana - The Hierophant</div>
                <div class="arcana-item" onclick="startArcanaMediation(6)">6th Arcana - The Lovers</div>
                <div class="arcana-item" onclick="startArcanaMediation(7)">7th Arcana - The Chariot</div>
                <div class="arcana-item" onclick="startArcanaMediation(8)">8th Arcana - Strength</div>
                <div class="arcana-item" onclick="startArcanaMediation(9)">9th Arcana - The Hermit</div>
            </div>
        </div>
    </div>
</div>









<!-- AFFIRMATIONS PAGE -->
<div id="affirmations-page" class="page">
    <style>
        /* Force 2 columns on mobile - inline styles override everything */
        #affirmations-page .categories-grid {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 8px !important;
            padding: 0 10px !important;
            margin-bottom: 20px !important;
        }
        
        #affirmations-page .category-card {
            padding: 6px !important;
            text-align: center !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            cursor: pointer !important;
        }
        
        #affirmations-page .category-image {
            width: 100% !important;
            height: 210px !important;
            object-fit: cover !important;
            border-radius: 6px !important;
            margin-bottom: 6px !important;
        }
        
        #affirmations-page .category-card h3 {
            font-size: 0.65rem !important;
            line-height: 1.1 !important;
            margin: 0 !important;
            font-weight: 600 !important;
        }
        
        /* Extra small screens */
        @media (max-width: 400px) {
            #affirmations-page .categories-grid {
                gap: 6px !important;
                padding: 0 8px !important;
            }
            
            #affirmations-page .category-image {
                height: 40px !important;
            }
            
            #affirmations-page .category-card h3 {
                font-size: 0.6rem !important;
            }
        }
    </style>
    
    <div class="page-header">
        <h1>Daily Affirmations</h1>
        <p>Please choose one or more category of affirmation you want to receive daily.</p>
    </div>
        
    <div class="categories-grid">
        <div class="category-card" data-category="Think Positively">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/AkdKjxW.png" alt="Think Positively" class="category-image">
            <h3>Think Positively</h3>
        </div>
        <div class="category-card" data-category="Build Self-Confidence">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/5DPMF8f.jpeg" alt="Build Self-Confidence" class="category-image">
            <h3>Build Self-Confidence</h3>
        </div>
        <div class="category-card" data-category="Calm Your Anxiety">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/Pys0ekT.jpeg" alt="Calm Your Anxiety" class="category-image">
            <h3>Calm Your Anxiety</h3>
        </div>
        <div class="category-card" data-category="Nurture Self-Love">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/S49sBat.jpeg" alt="Nurture Self-Love" class="category-image">
            <h3>Nurture Self-Love</h3>
        </div>
        <div class="category-card" data-category="Express Gratitude">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/YI3fNAs.jpeg" alt="Express Gratitude" class="category-image">
            <h3>Express Gratitude</h3>
        </div>
        <div class="category-card" data-category="Achieve Success">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/JrbdKrS.jpeg" alt="Achieve Success" class="category-image">
            <h3>Achieve Success</h3>
        </div>
        <div class="category-card" data-category="Ignite Motivation">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/XWiENhI.jpeg" alt="Ignite Motivation" class="category-image">
            <h3>Ignite Motivation</h3>
        </div>
        <div class="category-card" data-category="Accept Yourself">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/m1Zq5I3.jpeg" alt="Accept Yourself" class="category-image">
            <h3>Accept Yourself</h3>
        </div>
        <div class="category-card" data-category="Love Your Body">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/3Rm5Tra.jpeg" alt="Love Your Body" class="category-image">
            <h3>Love Your Body</h3>
        </div>
        <div class="category-card" data-category="Accept Your Parents and Ancestral Bloodline Power">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/fApnskW.jpeg" alt="Accept Your Parents" class="category-image">
            <h3>Accept Your Parents and Ancestral Bloodline Power</h3>
        </div>
        <div class="category-card" data-category="Embrace Changes">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/ZQDMPvc.jpeg" alt="Embrace Changes" class="category-image">
            <h3>Embrace Changes</h3>
        </div>
        <div class="category-card" data-category="Gain Balance in Life">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/5KErJTv.jpeg" alt="Gain Balance in Life" class="category-image">
            <h3>Gain Balance in Life</h3>
        </div>
        <div class="category-card" data-category="Build Wealth">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/znv21C7.jpeg" alt="Build Wealth" class="category-image">
            <h3>Build Wealth</h3>
        </div>
        <div class="category-card" data-category="Lose Weight">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/TWPDy6i.jpeg" alt="Lose Weight" class="category-image">
            <h3>Lose Weight</h3>
        </div>
        <div class="category-card" data-category="Quit Smoking">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/X1Zdht4.jpeg" alt="Quit Smoking" class="category-image">
            <h3>Quit Smoking</h3>
        </div>
        <div class="category-card" data-category="Fight with Depression">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/AK1dx9Z.jpeg" alt="Fight with Depression" class="category-image">
            <h3>Fight with Depression</h3>
        </div>
        <div class="category-card" data-category="Forgive and Let Go">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/suadq1Y.jpeg" alt="Forgive and Let Go" class="category-image">
            <h3>Forgive and Let Go</h3>
        </div>
        <div class="category-card" data-category="Conquer Loneliness">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/KGGbMNT.jpeg" alt="Conquer Loneliness" class="category-image">
            <h3>Conquer Loneliness</h3>
        </div>
        <div class="category-card" data-category="Overcome Toxic Relationships">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/Wd0ebGW.jpeg" alt="Overcome Toxic Relationships" class="category-image">
            <h3>Overcome Toxic Relationships</h3>
        </div>
        <div class="category-card" data-category="Forge New Connections">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/XZYEVmQ.jpeg" alt="Forge New Connections" class="category-image">
            <h3>Forge New Connections</h3>
        </div>
        <div class="category-card" data-category="Nurture Sexuality">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/vbDoQpg.jpeg" alt="Nurture Sexuality" class="category-image">
            <h3>Nurture Sexuality</h3>
        </div>
        <div class="category-card" data-category="Manifest New Love">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/DSziwpW.jpeg" alt="Manifest New Love" class="category-image">
            <h3>Manifest New Love</h3>
        </div>
        <div class="category-card" data-category="Deal with Postpartum">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/x38RPSD.jpeg" alt="Deal with Postpartum" class="category-image">
            <h3>Deal with Postpartum</h3>
        </div>
        <div class="category-card" data-category="Awaken Spiritually">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/esmpWoH.jpeg" alt="Awaken Spiritually" class="category-image">
            <h3>Awaken Spiritually</h3>
        </div>
        <div class="category-card" data-category="Heal From Grief">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/q4hZU8P.jpeg" alt="Heal From Grief" class="category-image">
            <h3>Heal From Grief</h3>
        </div>
        <div class="category-card" data-category="Harness the Law of Attraction">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/znv21C7.jpeg" alt="Harness the Law of Attraction" class="category-image">
            <h3>Harness the Law of Attraction</h3>
        </div>
        <div class="category-card" data-category="Fuel Vitality">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/HDNgClm.jpeg" alt="Fuel Vitality" class="category-image">
            <h3>Fuel Vitality</h3>
        </div>
        <div class="category-card" data-category="Adopt Stoic Mindset">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/xYpvoOK.jpeg" alt="Adopt Stoic Mindset" class="category-image">
            <h3>Adopt Stoic Mindset</h3>
        </div>
        <div class="category-card" data-category="Inspire as a Leader">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/eIaaYZy.jpeg" alt="Inspire as a Leader" class="category-image">
            <h3>Inspire as a Leader</h3>
        </div>
                <div class="category-card" data-category="Elevate Career">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/0AFAi2K.jpeg" alt="Elevate Career" class="category-image">
            <h3>Elevate Career</h3>
        </div>
        
        <div class="category-card" data-category="Cherish Your Pregnancy">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/0mLr8wh.jpeg" alt="Cherish Your Pregnancy" class="category-image">
            <h3>Cherish Your Pregnancy</h3>
        </div>
        
        <div class="category-card" data-category="Sharpen Focus">
            <div class="checkbox"></div>
            <img src="https://i.imgur.com/U7sG7su.jpeg" alt="Sharpen Focus" class="category-image">
            <h3>Sharpen Focus</h3>
        </div>
    </div> <!-- Close categories-grid -->
</div> <!-- Close affirmations-page -->

<div class="selected-categories">
    <h3>Selected Categories:</h3>
    <div id="selected-list"></div>
</div>


<div class="setup-button-container" style="display: none;">
    <button id="setup-reminders-btn" class="btn primary-btn">📱 Setup Reminders</button>
</div>

   
       <div class="notification-setup" style="display: none;">
  
    <!-- Days Selection -->
    <div class="days-selection">
        <h4>Select Days:</h4>
        <div class="days-grid">
            <label class="day-checkbox">
                <input type="checkbox" value="monday" id="day-monday">
                <span>Mon</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="tuesday" id="day-tuesday">
                <span>Tue</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="wednesday" id="day-wednesday">
                <span>Wed</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="thursday" id="day-thursday">
                <span>Thu</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="friday" id="day-friday">
                <span>Fri</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="saturday" id="day-saturday">
                <span>Sat</span>
            </label>
            <label class="day-checkbox">
                <input type="checkbox" value="sunday" id="day-sunday">
                <span>Sun</span>
            </label>
        </div>
    </div>
    
    <!-- Frequency Selection -->
    <div class="frequency-selection">
        <h4>How often do you want to receive affirmations?</h4>
        <select id="frequency-select">
            <option value="1">Every hour</option>
            <option value="2">Every 2 hours</option>
            <option value="3">Every 3 hours</option>
            <option value="4">Every 4 hours</option>
            <option value="5">Every 5 hours</option>
        </select>
    </div>
    
    <!-- Start Time Selection -->
    <div class="start-time-selection">
        <h4>What time should the first affirmation be sent?</h4>
        <input type="time" id="start-time" value="09:00">
    </div>
    
    <!-- Save Button -->
    <button id="save-settings" class="btn save-btn">Save and Grant Permission </button>
            
    <!-- Preview Schedule -->
    <div id="schedule-preview" class="schedule-preview">
        <h4>Your Schedule Preview:</h4>
        <div id="preview-content"></div>
    </div>
</div>


      <!-- CALCULATORS PAGE -->
<div id="calculators-page" class="page">
    <div class="page-header">
        <h1>Calculators</h1>
        <p>Unlock your spiritual insights with our premium calculators</p>
    </div>
    <div class="calculators-section">
        <div class="calculators-grid">

        <!-- Money Code Calculator -->
<div class="title-with-lock" data-calculator="money-code" onclick="showCodeInput('money-code')">
    <h3 class="calculator-title">MONEY CODE CALCULATOR</h3>
    <div class="lock-overlay">
        <div class="lock-icon">🔒</div>
        <p class="unlock-text">Unlock with Access Code</p>
    </div>
</div>

<div class="calculator-image">
    <img src="https://i.imgur.com/I7CUbj8.png" alt="Money Code Calculator">
</div>




            </div>
            <div class="calculator-description">
                <p><strong>What's Your Money Code? Unlock the Energy Behind Your Wealth</strong></p>
                <p>Your birth date carries a unique money blueprint — a personal energy pattern that reveals how you naturally attract wealth, where your financial power lies, and what may be quietly blocking your abundance.</p>
                <p>With just one click, this calculator decodes your Money Triangle: six powerful financial energies based on ancient Arcana wisdom. You'll uncover:</p>
                <ul>
                    <li>✔ Your natural paths to generating income</li>
                    <li>✔ The hidden blocks that may be limiting your financial flow</li>
                    <li>✔ Personalized ways to grow your wealth in alignment with your energy</li>
                    <li>✔ How to use money as a tool for purpose, growth, and freedom</li>
                </ul>
                <p>Whether you're feeling stuck or ready to thrive, this is your first step to a more conscious, empowered relationship with money.</p>
            </div>
            <div class="calculator-buttons">
                <button class="btn get-access-btn" onclick="window.open('https://payhip.com/b/fPRZK', '_blank')">Get Access Here</button>
                <button class="btn unlock-btn" onclick="showCodeInput('money-code')">I Have Access Code</button>
            </div>
        </div>
<!-- Forecast Calculator -->
<div class="calculator-card" data-calculator="forecast">
    <div class="title-with-lock">
        <h3 class="calculator-title"> FORECAST CALCULATOR</h3>
        <div class="lock-overlay">
            <div class="lock-icon">🔒</div>
            <p class="unlock-text">Unlock with Access Code</p>
        </div>
    </div>
    <div class="calculator-image">
        <img src="https://i.imgur.com/8ZfupjB.png" alt="Forecast Calculator">
    </div>
    <div class="calculator-description">
        <p><strong>Your Personal Energy Forecast — Aligned Guidance for Your Day, Month & Year</strong></p>
        <p>Imagine waking up and knowing exactly what kind of energy surrounds you — and how to make the most of it. This calculator reveals your unique daily, monthly, and yearly forecasts, based on your date of birth.</p>
        <p>Get practical and intuitive guidance tailored to your personal rhythm:</p>
        <ul>
            <li>✔ The energetic tone of your day, month, and year</li>
            <li>✔ Personalized tips for your health, money, and relationships</li>
            <li>✔ What to embrace — and what to avoid — to stay aligned</li>
            <li>✔ How to navigate challenges with more clarity and confidence</li>
        </ul>
        <p>Whether you're planning your day or realigning your year, this tool helps you work with your energy, not against it.</p>
    </div>
    <div class="calculator-buttons">
        <button class="btn get-access-btn" onclick="window.open('https://payhip.com/b/KOfjY', '_blank')">Get Access Here</button>
        <button class="btn unlock-btn" onclick="showCodeInput('forecast')">I Have Access Code</button>
    </div>
</div>
 </div>
</div>

        <!-- YOUR LIFE MAP PAGE -->
<div id="lifemap-page" class="page">
    <div class="page-header">
        <h1>️ Your Life Map</h1>
        <p>Discover the hidden energies that shape your destiny.</p> Absolutely FREE 
        </p>
    </div>
    
    <div class="lifemap-content">
    <div class="lifemap-description">
        <p>Curious about your true potential? Discover the hidden energies that shape your <strong>Personality, Spiritual Path, Financial Abundance, Relationships, Health, and Soul Mission</strong> — all based on your unique date of birth.</p>
    </div>
    <br><br>
    
   <div class="lifemap-image">
    <img src="https://i.imgur.com/JC011D8.jpeg" alt="Life Map Discovery" />
    <br><br>
    <p>This free, instant tool reveals your core life energies and their positive aspects, helping you understand how to harness your strengths for greater clarity, success, and fulfillment. No waiting, no cost — just powerful insight right at your fingertips.</p>
    <br><br>
    <img src="https://i.imgur.com/MuyxWVP.png" alt="Life Map Discovery2" />
</div>

<br><br>
        <div class="lifemap-message">
            <p><strong>What if the answers you've been searching for were already written in your energy from the moment you were born?</strong></p>
            
            <p>You'll discover what's supporting you, what may be blocking you, and how to turn your unique energy into your greatest strength.</p>
            
            <p><em>It's not just insight — it's a mirror to your soul.</em></p>
            
            <p><strong>No guesswork. No cost. Just clarity and direction, starting right now.</strong></p>
        </div>
         <br><br>
        <div class="lifemap-button">
            <button class="btn lifemap-btn" onclick="window.open('https://t.me/decoded_dob_bot?start=w40258673', '_blank')">
                 Show Me My Path
            </button>
        </div>
    </div>
</div>



   <!-- BOTTOM NAVIGATION -->
<nav class="bottom-nav">
    <div class="nav-item menu-item" data-page="home">
        <div class="nav-icon">⾕</div>
        <div class="nav-label">Home</div>
    </div>
    <div class="nav-item menu-item" data-page="meditations">
        <div class="nav-icon">☪︎</div>
        <div class="nav-label">Meditate</div>
    </div>
    <div class="nav-item menu-item" data-page="lifemap">
        <div class="nav-icon">༺☆༻️</div>
        <div class="nav-label">Decode</div>
    </div>
    <div class="nav-item menu-item" data-page="affirmations">
        <div class="nav-icon">⛥</div>
        <div class="nav-label">Affirm</div>
    </div>
    <div class="nav-item menu-item" data-page="calculators">
        <div class="nav-icon">🀙</div>
        <div class="nav-label">Calculate</div>
    </div>
</nav>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
                       <h2>SoulCode</h2>
            <p>Connecting to your spiritual journey...</p>
        </div>
    </div>
    
   <!-- Access Code Modal -->
<div id="code-modal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; 
    background: rgba(0,0,0,0.5); z-index: 1000;">
  <div class="modal-content" style="background:#fff; padding: 20px; max-width: 400px; margin: 10% auto; border-radius: 8px;">
    <h2>Enter Access Code</h2>
    <input id="access-code-input" type="text" placeholder="Enter your code here" style="width: 100%; padding: 8px; font-size: 16px; margin-bottom: 10px;"/>
    <div>
      <button class="btn" onclick="validateCode()">Submit</button>
      <button class="btn" onclick="closeCodeModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-messaging.js";
  import { getFirestore, doc, setDoc, collection, query, where, orderBy, limit, getDocs, Timestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink, onAuthStateChanged, sendPasswordResetEmail, updatePassword, GoogleAuthProvider, signInWithPopup, OAuthProvider } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";


  const firebaseConfig = {
    apiKey: "AIzaSyAPCFjjC6SqtQEauTQ6Hs7Ex-B2tj6PuXM",
    authDomain: "soul-code-app.firebaseapp.com",
    projectId: "soul-code-app",
    storageBucket: "soul-code-app.firebasestorage.app",
    messagingSenderId: "339179205157",
    appId: "1:339179205157:web:e801c0ad054cbc6a1c05cc",
    measurementId: "G-C1K5PGZJB7"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const messaging = getMessaging(app);
  const db = getFirestore(app);
  let currentUser = null;
  const auth = getAuth(app);

  // AUTHENTICATION STATE LISTENER - FIXED:  
onAuthStateChanged(auth, (user) => {
  console.log('Auth state changed:', user);
  if (user) {
    window.currentUser = user;
    currentUser = user;
    console.log('User signed in:', user.email);
    console.log('About to call showMainApp()');
    // Add small delay to ensure DOM is ready
    setTimeout(() => {
      showMainApp();
    }, 100);
  } else {
    currentUser = null;
    console.log('User signed out');
    showAuthScreen();
  }
});

  // UTILITY FUNCTIONS:
  function generateRandomPassword(length = 12) {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
    let password = "";
    for (let i = 0; i < length; i++) {
      password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    return password;
  }

  function showPasswordConfirmationModal(email, autoPassword) {
  return new Promise((resolve) => {
    const modalHTML = `
      <div id="password-modal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(53, 12, 72, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(10px);
      ">
        <div style="
          background: linear-gradient(135deg, #350c48 0%, #4a1a5c 100%);
          padding: 40px;
          border-radius: 20px;
          max-width: 450px;
          width: 90%;
          text-align: center;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
          border: 2px solid #ccae79;
        ">
          <h3 style="color: #ccae79; margin-bottom: 15px; font-size: 24px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Account Created!</h3>
          <p style="color: #caafe0; margin-bottom: 10px; font-size: 16px;">for ${email}</p>
          <p style="color: #caafe0; margin-bottom: 20px;">Your auto-generated password is:</p>
          <div style="
            background: linear-gradient(135deg, rgba(204, 174, 121, 0.2) 0%, rgba(202, 175, 224, 0.2) 100%);
            padding: 20px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 20px 0;
            word-break: break-all;
            border: 2px solid #ccae79;
            color: #ccae79;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
          ">${autoPassword}</div>
          <p style="color: #caafe0; margin-bottom: 25px;">Would you like to keep this password or create your own?</p>
          <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <button id="keep-password" style="
              background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%);
              color: #350c48;
              border: none;
              padding: 15px 25px;
              border-radius: 25px;
              font-size: 16px;
              font-weight: bold;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(0,0,0,0.3);
              min-width: 150px;
            ">Keep This Password</button>
            <button id="create-own" style="
              background: linear-gradient(135deg, #350c48 0%, #4a1a5c 100%);
              color: #ccae79;
              border: 2px solid #ccae79;
              padding: 15px 25px;
              border-radius: 25px;
              font-size: 16px;
              font-weight: bold;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(0,0,0,0.3);
              min-width: 150px;
            ">Create My Own</button>
          </div>
          <div id="custom-password-section" style="display: none; margin-top: 25px;">
            <input type="password" id="custom-password" placeholder="Enter your password" style="
              width: 100%;
              padding: 15px;
              margin: 10px 0;
              border: 2px solid #ccae79;
              border-radius: 15px;
              box-sizing: border-box;
              font-size: 16px;
              background: rgba(255,255,255,0.1);
              color: #ccae79;
            ">
            <input type="password" id="confirm-password" placeholder="Confirm password" style="
              width: 100%;
              padding: 15px;
              margin: 10px 0;
              border: 2px solid #ccae79;
              border-radius: 15px;
              box-sizing: border-box;
              font-size: 16px;
              background: rgba(255,255,255,0.1);
              color: #ccae79;
            ">
            <button id="save-custom" style="
              background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%);
              color: #350c48;
              border: none;
              padding: 15px 25px;
              border-radius: 25px;
              font-size: 16px;
              font-weight: bold;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(0,0,0,0.3);
              width: 100%;
              margin-top: 10px;
            ">Save Password</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    // Add hover effects
    document.getElementById('keep-password').onmouseover = function() {
      this.style.transform = 'translateY(-2px)';
      this.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
      this.style.background = 'linear-gradient(135deg, #b8a06b 0%, #b49dd4 100%)';
    };
    document.getElementById('keep-password').onmouseout = function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
      this.style.background = 'linear-gradient(135deg, #ccae79 0%, #caafe0 100%)';
    };
    document.getElementById('create-own').onmouseover = function() {
      this.style.transform = 'translateY(-2px)';
      this.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
      this.style.background = 'linear-gradient(135deg, #2a0a3a 0%, #3d1548 100%)';
    };
    document.getElementById('create-own').onmouseout = function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
      this.style.background = 'linear-gradient(135deg, #350c48 0%, #4a1a5c 100%)';
    };
    document.getElementById('save-custom').onmouseover = function() {
      this.style.transform = 'translateY(-2px)';
      this.style.boxShadow = '0 6px 20px rgba(0,0,0,0.4)';
      this.style.background = 'linear-gradient(135deg, #b8a06b 0%, #b49dd4 100%)';
    };
    document.getElementById('save-custom').onmouseout = function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
      this.style.background = 'linear-gradient(135deg, #ccae79 0%, #caafe0 100%)';
    };

    document.getElementById('keep-password').onclick = () => {
      document.getElementById('password-modal').remove();
      resolve(autoPassword);
    };

    document.getElementById('create-own').onclick = () => {
      document.getElementById('custom-password-section').style.display = 'block';
      document.getElementById('keep-password').style.display = 'none';
      document.getElementById('create-own').style.display = 'none';
    };

    document.getElementById('save-custom').onclick = () => {
      const customPassword = document.getElementById('custom-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      if (!customPassword) {
        alert('Please enter a password');
        return;
      }
      if (customPassword !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      if (customPassword.length < 6) {
        alert('Password must be at least 6 characters long');
        return;
      }
      document.getElementById('password-modal').remove();
      resolve(customPassword);
    };
  });
}

  // UPDATED AUTHENTICATION FUNCTIONS:
  window.signUpWithEmail = async function(email, password) {
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      console.log('User created:', userCredential.user.email);
      return userCredential;
    } catch (error) {
      console.error('Sign up error:', error.message);
      throw error;
    }
  };

  window.signInWithEmail = async function(email, password) {
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      console.log('User signed in:', userCredential.user.email);
      return userCredential;
    } catch (error) {
      console.error('Sign in error:', error.message);
      
      // Provide specific error messages
      let errorMessage = '';
      switch (error.code) {
        case 'auth/wrong-password':
        case 'auth/invalid-credential':
          errorMessage = 'Incorrect password. Please try again.';
          break;
        case 'auth/user-not-found':
          errorMessage = 'No account found with this email address.';
          break;
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address.';
          break;
        case 'auth/too-many-requests':
          errorMessage = 'Too many failed attempts. Please try again later.';
          break;
        default:
          errorMessage = error.message;
      }
      
      alert('Sign in failed: ' + errorMessage);
      throw error;
    }
  };

  window.sendPasswordlessLink = async function(email) {
    const actionCodeSettings = {
      url: window.location.href,
      handleCodeInApp: true,
    };
      
    try {
      await sendSignInLinkToEmail(auth, email, actionCodeSettings);
      localStorage.setItem('emailForSignIn', email);
      alert('Sign-in link sent to your email!');
    } catch (error) {
      console.error('Error sending email link:', error.message);
      alert('Failed to send email link: ' + error.message);
    }
  };

  // BUTTON 1 - RETURNING USER FUNCTION
window.handleReturningUser = async function() {
  const modalHTML = `
    <div id="returning-user-modal" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    ">
      <div style="
        background: white;
        padding: 30px;
        border-radius: 10px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      ">
        <h3>Welcome Back!</h3>
        <input type="email" id="returning-email" placeholder="Enter your email" style="
          width: 100%;
          padding: 15px;
          margin: 10px 0;
          border: 1px solid #ddd;
          border-radius: 5px;
          box-sizing: border-box;
        ">
        <input type="password" id="returning-password" placeholder="Enter your password" style="
          width: 100%;
          padding: 15px;
          margin: 10px 0;
          border: 1px solid #ddd;
          border-radius: 5px;
          box-sizing: border-box;
        ">
        <button id="login-btn" class="btn">Login</button>
        <button id="cancel-login" style="
  background: linear-gradient(135deg, #350c48 0%, #4a1a5c 100%);
  color: #ccae79;
  border: 2px solid #ccae79;
  padding: 15px 25px;
  margin: 10px;
  border-radius: 25px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  min-width: 120px;
">Cancel</button>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHTML);
  
  document.getElementById('cancel-login').onclick = () => {
    document.getElementById('returning-user-modal').remove();
  };
  
  document.getElementById('login-btn').onclick = async () => {
    const email = document.getElementById('returning-email').value.trim();
    const password = document.getElementById('returning-password').value;
    
    if (!email || !password) {
      alert('Please enter both email and password');
      return;
    }
    
    try {
      await signInWithEmailAndPassword(auth, email, password);
      document.getElementById('returning-user-modal').remove();
    } catch (error) {
      if (error.code === 'auth/user-not-found') {
        alert('No account found with this email. Please create an account.');
        document.getElementById('returning-user-modal').remove();
      } else if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
        const resetPassword = confirm('Wrong password. Would you like to reset your password via email?');
        if (resetPassword) {
          try {
            await sendPasswordResetEmail(auth, email);
            alert('Password reset email sent! Please check your inbox.');
            document.getElementById('returning-user-modal').remove();
          } catch (resetError) {
            alert('Error sending reset email: ' + resetError.message);
          }
        }
      } else {
        alert('Login error: ' + error.message);
      }
    }
  };
};

// BUTTON 2 - NEW USER FUNCTION
window.handleNewUser = async function() {
  // Step 1: Email input modal
  const emailModalHTML = `
    <div id="new-user-email-modal" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    ">
      <div style="
        background: white;
        padding: 30px;
        border-radius: 10px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      ">
        <h3>Create New Account</h3>
        <p>Enter your email address to get started</p>
        <input type="email" id="new-user-email" placeholder="Enter your email" style="
          width: 100%;
          padding: 15px;
          margin: 10px 0;
          border: 1px solid #ddd;
          border-radius: 5px;
          box-sizing: border-box;
        ">
        <button id="continue-btn" class="btn">Continue</button>
        <button id="cancel-new-user" style="
         background: linear-gradient(135deg, #350c48 0%, #4a1a5c 100%);
  color: #ccae79;
          border: none;
          padding: 10px 20px;
          margin: 10px;
          border-radius: 5px;
          cursor: pointer;
        ">Cancel</button>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', emailModalHTML);
  
  document.getElementById('cancel-new-user').onclick = () => {
    document.getElementById('new-user-email-modal').remove();
  };
  
  document.getElementById('continue-btn').onclick = async () => {
    const email = document.getElementById('new-user-email').value.trim();
    
    if (!email) {
      alert('Please enter your email');
      return;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('Please enter a valid email address');
      return;
    }
    
    document.getElementById('new-user-email-modal').remove();
    
    // Step 2: Password selection modal
    const autoPassword = generateRandomPassword();
    const finalPassword = await showPasswordConfirmationModal(email, autoPassword);
    
    // Step 3: Create account
    try {
      await createUserWithEmailAndPassword(auth, email, finalPassword);
      alert('Account successfully created! Welcome to SoulCode!');
    } catch (error) {
      alert('Failed to create account: ' + error.message);
    }
  };
};



  window.signInWithGoogle = async function() {
  try {
    const provider = new GoogleAuthProvider();
    const result = await signInWithPopup(auth, provider);
    console.log('Google sign-in successful:', result.user.email);
    return result;
  } catch (error) {
    console.error('Google sign-in error:', error.message);
    alert('Google sign-in failed: ' + error.message);
  }
};

window.signInWithApple = async function() {
  try {
    const provider = new OAuthProvider('apple.com');
    const result = await signInWithPopup(auth, provider);
    console.log('Apple sign-in successful:', result.user.email);
    return result;
  } catch (error) {
    console.error('Apple sign-in error:', error.message);
    alert('Apple sign-in failed: ' + error.message);
  }
};


  // UPDATED SCREEN FUNCTIONS:
  function showAuthScreen() {
    console.log('Showing auth screen');
    const authScreen = document.getElementById('auth-screen');
    const mainApp = document.getElementById('main-app');
    
    if (authScreen) authScreen.style.display = 'block';
    if (mainApp) mainApp.style.display = 'none';
  }

  function showMainApp() {
    console.log('Showing main app');
    const authScreen = document.getElementById('auth-screen');
    const mainApp = document.getElementById('main-app');
    
    if (authScreen) authScreen.style.display = 'none';
    if (mainApp) {
      mainApp.style.display = 'block';
      console.log('Main app is now visible');
    } else {
      console.error('Main app element not found - check your HTML element ID');
    }
  }

  // KEEP ALL OTHER FUNCTIONS UNCHANGED:
 window.saveUserPreferences = async function(userId, categories, schedule) {
  if (!currentUser) {
    alert('Please sign in first');
    return;
  }
  try {
    const selectedAffirmations = {};
    categories.forEach(categoryKey => {
      selectedAffirmations[categoryKey] = {
        name: categoryKey,
        selected: true
      };
    });

    // Get FCM token
    let pushToken = null;
    try {
      const permission = await Notification.requestPermission();
      if (permission === 'granted') {
        pushToken = await getToken(messaging, {
          vapidKey: 'BFeiQnMxZlXHXxtQrAPvWSJ_1XnTklpH2IEcPAG_qjoxKKwHICnJOaEjzK3rq5zNMyaD02_gjJPqtBA6WYGu20U'
        });
        console.log('Push token obtained:', pushToken);
      }
    } catch (tokenError) {
      console.error('Error getting push token:', tokenError);
    }
        
    await setDoc(doc(db, "users", currentUser.uid), {
      email: currentUser.email,
      selectedCategories: categories,
      selectedAffirmations: selectedAffirmations,
      schedule: schedule,
      pushToken: pushToken, // ADD THIS LINE
      createdAt: new Date()
    });
    console.log("Preferences saved to Firestore successfully!");
  } catch (error) {
    console.error("Error saving preferences:", error);
  }
}

 // FCM TOKEN FUNCTIONS - FIXED:
async function getFcmToken() {
  try {
    const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
    console.log('Service worker registered:', registration);

    const currentToken = await getToken(messaging, {
      vapidKey: 'BFeiQnMxZlXHXxtQrAPvWSJ_1XnTklpH2IEcPAG_qjoxKKwHICnJOaEjzK3rq5zNMyaD02_gjJPqtBA6WYGu20U',
      serviceWorkerRegistration: registration
    });

    if (currentToken) {
      console.log('FCM Token:', currentToken);

      await setDoc(doc(db, "users", currentUser.uid), {
        email: currentUser.email,
        fcmToken: currentToken,
      }, { merge: true });

      console.log("FCM Token saved to Firestore successfully!");
    } else {
      console.warn('No registration token available. Permission required.');
    }
  } catch (err) {
    console.error('Error while retrieving token:', err);
  }
}

Notification.requestPermission().then((permission) => {
  console.log('Notification permission status:', permission);
  if (permission === 'granted') {
    getFcmToken();
  } else {
    console.warn('Notification permission not granted');
  }
});

onMessage(messaging, (payload) => {
    console.log('Foreground message received:', payload);
    if (Notification.permission === 'granted' && /Android/i.test(navigator.userAgent)) {
        navigator.serviceWorker.ready.then(registration => {
            registration.showNotification('SoulCode', {
                body: payload.notification.body,
                icon: '/icon-192.png',
                badge: '/icon-192.png',
                vibrate: [200, 100, 200],
                tag: 'soulcode-affirmation'
            });
        });
    }
});



// Recent Affirmations Functions - INSIDE MODULE with Event Listeners

function openRecentAffirmations() {
    console.log('openRecentAffirmations called');
    document.getElementById('recent-affirmations-modal').classList.remove('hidden');
    showRealAffirmations();
}

function closeRecentAffirmations() {
    console.log('closeRecentAffirmations called');
    document.getElementById('recent-affirmations-modal').classList.add('hidden');
}
async function showRealAffirmations() {
    console.log('Loading real affirmations...');
    const loadingDiv = document.getElementById('affirmations-loading');
    const noAffirmationsDiv = document.getElementById('no-affirmations');
    const affirmationsListDiv = document.getElementById('affirmations-list');
    
    loadingDiv.style.display = 'block';
    noAffirmationsDiv.style.display = 'none';
    affirmationsListDiv.style.display = 'none';
    
    try {
        // Simplified query - just get recent logs for this user
        const q = query(
            collection(db, 'notification_logs'),
            where('userId', '==', currentUser.uid),
            orderBy('sentAt', 'desc'),
            limit(20)
        );
        
        const snapshot = await getDocs(q);
        const affirmations = [];
        
        // Filter in JavaScript instead of Firestore
        const twelveHoursAgo = new Date();
        twelveHoursAgo.setHours(twelveHoursAgo.getHours() - 12);
        
        snapshot.forEach(doc => {
            const data = doc.data();
            // Filter for sent status and recent time
            if (data.status === 'sent' && data.sentAt.toDate() >= twelveHoursAgo) {
                affirmations.push({
                    affirmationText: data.affirmationText,
                    category: data.category,
                    sentAt: data.sentAt.toDate()
                });
            }
        });
        
        loadingDiv.style.display = 'none';
        
        if (affirmations.length === 0) {
            noAffirmationsDiv.style.display = 'block';
        } else {
            displayRealAffirmations(affirmations);
            affirmationsListDiv.style.display = 'block';
        }
        
    } catch (error) {
        console.error('Error loading affirmations:', error);
        loadingDiv.style.display = 'none';
        noAffirmationsDiv.style.display = 'block';
    }
}


function displayRealAffirmations(affirmations) {
    const affirmationsListDiv = document.getElementById('affirmations-list');
    affirmationsListDiv.innerHTML = '';
    
    affirmations.forEach(data => {
        const timeAgo = getTimeAgo(data.sentAt);
        
        const affirmationItem = document.createElement('div');
        affirmationItem.style.cssText = `
            background: linear-gradient(135deg, rgba(204, 174, 121, 0.1) 0%, rgba(202, 175, 224, 0.1) 100%);
            border: 1px solid rgba(204, 174, 121, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            color: white;
        `;
        
        affirmationItem.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <span style="background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%); color: #350c48; padding: 4px 8px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                    ${data.category || 'Daily Inspiration'}
                </span>
                <span style="font-size: 12px; color: rgba(255,255,255,0.7);">
                    ${timeAgo}
                </span>
            </div>
            <p style="margin: 0; line-height: 1.5; font-size: 14px;">
                "${data.affirmationText}"
            </p>
        `;
        
        affirmationsListDiv.appendChild(affirmationItem);
    });
}

function getTimeAgo(date) {
    const now = new Date();
    const diffInMinutes = Math.floor((now - date) / (1000 * 60));
    
    if (diffInMinutes < 60) {
        return `${diffInMinutes}m ago`;
    } else {
        const diffInHours = Math.floor(diffInMinutes / 60);
        return `${diffInHours}h ago`;
    }
}

function refreshAffirmations() {
    console.log('refreshAffirmations called');
    showRealAffirmations();
}

// Add the enhanced event listeners here
document.addEventListener('DOMContentLoaded', () => {
    const recentAffirmationsBtn = document.getElementById('recent-affirmations-btn');
    
    recentAffirmationsBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        e.stopPropagation();
        openRecentAffirmations();
    }, false);
});

// Add event listener here
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('recent-affirmations-btn');
    if (btn) {
        btn.addEventListener('click', openRecentAffirmations);
    }
    
    const refreshBtn = document.getElementById('refresh-affirmations-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', refreshAffirmations);
    }
});

document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('recent-affirmations-btn');
    if (btn) {
        btn.addEventListener('click', openRecentAffirmations);
    }
    
    // ADD THIS:
    const closeBtn = document.getElementById('close-modal-btn');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeRecentAffirmations);
    }
});



</script>




    <!-- Scripts -->
    <script>
        
        
let usedMessages = [];
let allMessages = [];

// Messages embedded directly
function loadMessages() {
    allMessages = [
        "Pause and breathe deeply. Within stillness lies the clarity you seek.",
        "Trust the unfolding of your journey; each step holds unseen gifts.",
        "Release what no longer serves you and make space for new possibilities.",
        "Embrace the present moment — it is where your power resides.",
"Allow yourself to receive support, even when you feel strong.",
    "Courage often whispers softly; listen closely to your inner voice.",
    "Growth happens quietly, in the spaces between effort and rest.",
    "Your worth is not defined by outcomes but by the love you carry.",
    "In uncertainty, find the chance to create something new.",
    "Let go of resistance and flow with the natural rhythm of life.",
    "Small steps forward build the path to your greatest dreams.",
    "Compassion toward yourself opens the door to healing.",
    "Notice what brings you peace and return to it often.",
    "Every ending carries the seed of a new beginning.",
    "Your intuition is a wise guide; trust its gentle nudges.",
    "Embrace change as a doorway to growth, not loss.",
    "Find gratitude in the simple moments—they hold profound meaning.",
    "Rest is a vital part of progress, honor your need to recharge.",
    "When doubts arise, remember the strength you’ve already shown.",
    "Your journey is unique; compare only to your own yesterday.",
    "Seek balance by honoring both your heart and your mind.",
    "The answers you seek often come in unexpected ways.",
    "Let kindness be the foundation of your actions today.",
    "Patience allows wisdom to bloom within your experience.",
    "What you nurture today will flourish tomorrow.",
    "Embrace the mystery of life with open arms and curious eyes.",
    "Your presence is a gift—share it generously with the world.",
    "Trust that setbacks are stepping stones to deeper understanding.",
    "Celebrate progress, no matter how small it seems.",
    "Choose hope as your compass in times of challenge.",
    "Embrace your imperfections; they are the colors that make you unique.",
    "Look for the lesson hidden within every challenge.",
    "Peace begins with acceptance — start within.",
    "Open your heart to possibilities beyond your current vision.",
    "Strength grows when you face fears with gentle courage.",
    "Allow yourself space to dream without limits.",
    "Trust the timing of your life, even when the path is unclear.",
    "Healing is a process — honor each step without judgment.",
    "Your energy creates your experience; nurture it wisely.",
    "Release control and invite flow into your day.",
    "Your story matters; embrace it with compassion.",
    "Find beauty in the ordinary moments around you.",
    "You are more capable than you realize — keep moving forward.",
    "Let your kindness ripple outward, touching all you meet.",
    "Growth requires patience—be gentle with your pace.",
    "Look inward for strength when the outside feels uncertain.",
    "You are not alone; support surrounds you in many forms.",
    "Every breath is a new beginning.",
    "Embrace silence as a source of wisdom and clarity.",
    "Balance action with rest to sustain your journey.",
    "Release the need for perfection and welcome progress.",
    "Your inner light shines brightest through challenges.",
    "Give yourself permission to rest without guilt.",
    "The seeds you plant today will bloom in time.",
    "Choose peace over worry in every moment you can.",
    "Trust that the universe is guiding you toward your highest good.",
    "Let gratitude fill your heart and open new doors.",
    "Your resilience is a quiet, steady flame — tend to it.",
    "Find joy in small victories along your path.",
    "Nurture your dreams with consistent, loving attention.",
    "Trust your inner wisdom to guide you through uncertainty.",
    "The journey is as important as the destination—cherish each step.",
    "You have the power to choose peace in any moment.",
    "Let go of what weighs you down and rise lighter.",
    "Embrace curiosity—it leads to new paths and growth.",
    "Your heart knows what your mind may forget.",
    "Patience opens doors that force cannot.",
    "Take time to nurture your soul as you do your goals.",
    "Your presence can heal wounds—start with yourself.",
    "Open your eyes to the miracles in everyday life.",
    "Trust that challenges are shaping your strength.",
    "Celebrate who you are becoming, not just what you achieve.",
    "When you stumble, pause and learn before moving forward.",
    "Release judgment and practice kindness toward yourself.",
    "Your courage inspires others more than you realize.",
    "Every act of self-care strengthens your foundation.",
    "Allow your intentions to grow without pressure or expectation.",
    "You are a beacon of light in your own story.",
    "Trust the process, even when the path feels unknown.",
    "Be gentle with yourself during times of change.",
    "Let your breath anchor you in moments of doubt.",
    "Focus on what you can control and release the rest.",
    "Your dreams are valid and worth pursuing.",
    "Seek harmony between your ambitions and well-being.",
    "Give yourself permission to say no when needed.",
    "Every step forward is a victory to honor.",
    "Your inner peace radiates outward to those around you.",
    "Accept support gracefully—it strengthens your journey.",
    "Approach each day with an open heart and mind.",
    "Trust that every ending makes way for a new beginning.",
    "Embrace the unknown as an opportunity for growth.",
    "Your heart’s wisdom is always accessible—listen closely.",
    "Healing begins the moment you offer yourself compassion.",
    "Find strength in stillness and clarity in quiet moments.",
    "You are more resilient than any challenge you face.",
    "Let your intentions be rooted in love and kindness.",
    "Each day is a fresh page—write it with purpose.",
    "Trust your inner compass to lead you true.",
    "Accept what is and create what could be.",
    "Let go of fear and welcome possibility.",
    "Your journey unfolds exactly as it should.",
    "You have everything you need to move forward.",
    "Patience nurtures growth beyond what eyes can see.",
    "Find peace in surrendering control.",
    "Your value is inherent, not earned by achievement.",
    "Rest is essential to your strength and clarity.",
    "Celebrate progress, no matter how small.",
    "Open your heart to new perspectives.",
    "What you nurture within grows outward in time.",
    "Be kind to your past self as you grow today.",
    "Embrace change as a natural part of your evolution.",
    "Your breath grounds you in the present moment.",
    "Clarity comes when you release expectations.",
    "You are the author of your own story.",
    "Focus on what lifts you higher today.",
    "Growth often looks like small, steady steps.",
    "Your intuition speaks softly—trust its guidance.",
    "Let your kindness be your strength.",
    "Embrace moments of pause to recharge and reflect.",
    "The light you seek shines from within.",
    "Allow yourself to release what no longer serves your highest good.",
    "Your presence is a gift that can heal and inspire.",
    "Trust that every experience teaches you something valuable.",
    "You have the strength to rise above any challenge.",
    "Let your heart guide your steps today.",
    "Every breath is an opportunity to begin anew.",
    "Nurture your dreams with patience and faith.",
    "Small acts of kindness create powerful ripples.",
    "When you feel lost, return to your center.",
    "Embrace the power of possibility in each moment.",
    "Your journey is uniquely yours—honor it fully.",
    "Peace begins when you accept yourself completely.",
    "Trust the process of unfolding, even when it’s unclear.",
    "Let go of what you cannot change and focus on what you can.",
    "Your resilience is a quiet, powerful force.",
    "Seek balance between doing and being.",
    "Your intuition is a trustworthy companion—listen often.",
    "Give yourself permission to rest and recharge.",
    "Growth often comes disguised as discomfort.",
    "Celebrate the courage it takes to keep going.",
    "Each moment offers a chance to start fresh.",
    "Embrace your unique path without comparison.",
    "Your inner peace is your greatest strength.",
    "Release resistance and invite flow into your life.",
    "Trust in the wisdom that comes from experience.",
    "Let gratitude soften your heart and expand your vision.",
    "You are worthy of love, success, and happiness.",
    "Focus on the good and it will multiply.",
    "Patience and perseverance open new doors.",
    "Your dreams are seeds—water them with intention.",
    "Listen to your heart’s whispers—they carry truth.",
    "Embrace uncertainty as a space for growth.",
    "Let your kindness be a light in the darkness.",
    "You have the power to create positive change.",
    "Balance action with rest for sustained progress.",
    "Be gentle with yourself in moments of struggle.",
    "Your story is still being written—choose your next chapter wisely.",
    "Trust that you are exactly where you need to be.",
    "Release fear and step boldly into your potential.",
    "Embrace the journey, with all its twists and turns.",
    "Every challenge you face is an opportunity for growth and learning.",
    "Allow yourself to move at your own pace without pressure.",
    "Trust that clarity will come when the time is right.",
    "Embrace the lessons hidden within each experience.",
    "Your heart holds the key to your deepest wisdom.",
    "Release the need to control outcomes and trust the process.",
    "Celebrate your courage to face each new day.",
    "Your journey is a unique expression of your soul.",
    "Practice kindness toward yourself as you would to a friend.",
    "Find strength in surrendering to what is beyond your control.",
    "Allow joy to flow into your life through simple moments.",
    "You are connected to a greater source of love and support.",
    "Let your intuition guide you gently but firmly.",
    "Each breath grounds you more deeply in the present.",
    "Your intentions have the power to shape your reality.",
    "Embrace vulnerability as a pathway to strength.",
    "Trust in your ability to overcome obstacles with grace.",
    "Seek balance in all areas of your life for true harmony.",
    "Release self-doubt and welcome confidence.",
    "Nurture your body, mind, and spirit with love.",
    "You are worthy of rest and renewal.",
    "Let gratitude open your heart to abundance.",
    "Be present for the small miracles around you.",
    "You are capable of more than you realize.",
    "Accept yourself fully, imperfections and all.",
    "Take time to listen to the whispers of your soul.",
    "Your patience will bring great rewards.",
    "Find peace in the acceptance of what you cannot change.",
    "Every day is a fresh opportunity to grow and evolve.",
    "Trust that your path is unfolding perfectly.",
    "Embrace the unknown with curiosity and courage.",
    "Your presence has a positive impact on the world.",
    "Let go of fear and open your heart to possibility.",
    "Practice forgiveness to free your spirit.",
    "Be gentle with yourself during times of transition.",
    "Celebrate your progress, no matter how small.",
    "You have the strength to create positive change.",
    "Listen deeply to your inner guidance.",
    "Balance effort with rest to sustain your journey.",
    "Trust that you are exactly where you need to be, right now."
];
}

function spinCard() {
    const spinner = document.querySelector('.card-spinner');
    const result = document.getElementById('card-result');
    
    spinner.classList.add('spinning');
    
    setTimeout(() => {
        spinner.classList.remove('spinning');
        
        // Get random message
        let randomMessage = getRandomMessage();
        
        if (result) {
            result.classList.add('show');
            result.innerHTML = `<h3>⚝ </h3><p>${randomMessage}</p>`;
        }
    }, 2000);
}

   // Meditation URLs - Firebase Storage format
const meditationUrls = {
  'selflove': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/ytmp3free.cc_3d-self-love-guided-meditation-youtubemp3free.org.mp3?alt=media&token=0aa2fee7-10ea-4cd2-a174-423268f54a3b',
  'stress': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/ytmp3free.cc_stress-relief-guided-meditation-youtubemp3free.org.mp3?alt=media&token=debec40c-34da-4fc4-8c76-e2ae1b6f29ce',
  'breath': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/ytmp3free.cc_alleviate-stess-with-3-deep-breath-technique-guided-meditation-youtubemp3free.org.mp3?alt=media&token=32a58357-4669-47f1-a61c-a48d2a6666ae',
  'depression': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/ytmp3free.cc_relieve-depression-and-anxious-thought-guided-meditation-youtubemp3free.org.mp3?alt=media&token=e7b96c30-44a3-4b51-9685-2f1549efe86b',
  'mindfulness': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/ytmp3free.cc_mindfulness-relaxation-guided-10-minutes-meditation-youtubemp3free.org.mp3?alt=media&token=3cdacd79-d83f-4ca0-a656-34d43461153d',
  // Arcana meditations - replace with your actual Firebase Storage URLs
  'arcana1': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana1.mp3?alt=media&token=e80598ca-535d-4c6e-a717-650c3c77abbc',
  'arcana2': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana2.mp3?alt=media&token=dc153c94-cf9a-4ee0-881b-c0bfb67a6fbc',
  'arcana3': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana3.mp3?alt=media&token=5fc21025-a48b-406d-b11a-e2a015158e85',
  'arcana4': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana4.mp3?alt=media&token=dcee1b56-a038-45f1-b7e8-80d8600cdbf7',
  'arcana5': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana5.mp3?alt=media&token=ddcee584-3aa2-426e-a6ee-885fa6d2d57f',
  'arcana6': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana6.mp3?alt=media&token=7361b698-ce1f-4615-952b-9f6844739799',
  'arcana7': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana7.mp3?alt=media&token=6c31cc33-860a-4438-8ae5-b6c2faa5364f',
  'arcana8': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana8.mp3?alt=media&token=7920072f-243c-47a3-858f-08ad68325a24',
  'arcana9': 'https://firebasestorage.googleapis.com/v0/b/soul-code-app.firebasestorage.app/o/arcana9.mp3?alt=media&token=31634693-814b-42eb-9f98-e2f212c72228'
};

// Add meditation card click listeners
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.meditation-card[data-meditation]').forEach(card => {
        card.addEventListener('click', function() {
            const meditationType = this.getAttribute('data-meditation');
            if (meditationType !== 'personalized') {
                startMeditation(meditationType);
            }
        });
    });
});

// Global audio player variable
let currentAudio = null;

function startMeditation(type) {
    const player = document.getElementById('meditation-player');
    const url = meditationUrls[type];
    
    player.innerHTML = `
        <div class="player-container">
            <div class="player-image">
                <img src="https://i.imgur.com/ZB5vjZ0.jpeg" alt="Meditation">
                <div class="play-overlay">
                    <div class="play-button" onclick="playMeditation('${url}')">▶️</div>
                </div>
            </div>
            <div class="player-controls">
                <h3>${getReadableName(type)}</h3>
                <div class="control-buttons">
                    <button class="control-btn" onclick="playMeditation('${url}')">▶️ Play</button>
                    <button class="control-btn" onclick="pauseMeditation()">⏸️ Pause</button>
                    <button class="control-btn" onclick="stopMeditation()">⏹️ Stop</button>
                </div>
            </div>
        </div>
    `;
    player.classList.add('active');
}

function startArcanaMediation(arcanaNumber) {
    closeArcanaModal();
    const player = document.getElementById('meditation-player');
    const url = meditationUrls[`arcana${arcanaNumber}`];
    
    player.innerHTML = `
        <div class="player-container">
            <div class="player-image">
                <img src="https://i.imgur.com/9j6rJ83.jpeg" alt="Arcana Meditation">
                <div class="play-overlay">
                    <div class="play-button" onclick="playMeditation('${url}')">▶️</div>
                </div>
            </div>
            <div class="player-controls">
                <h3>${arcanaNumber}${getOrdinalSuffix(arcanaNumber)} Arcana Meditation</h3>
                <div class="control-buttons">
                    <button class="control-btn" onclick="playMeditation('${url}')">▶️ Play</button>
                    <button class="control-btn" onclick="pauseMeditation()">⏸️ Pause</button>
                    <button class="control-btn" onclick="stopMeditation()">⏹️ Stop</button>
                </div>
            </div>
        </div>
    `;
    player.classList.add('active');
}

function playMeditation(url) {
    // Stop any currently playing audio
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
    }

    // Create or get the audio element
    let audio = document.getElementById('hidden-audio-player');
    if (!audio) {
        audio = document.createElement('audio');
        audio.id = 'hidden-audio-player';
        audio.style.display = 'none';
        audio.controls = false;
        audio.preload = 'metadata';
        // Removed crossOrigin for Firebase Storage
        document.body.appendChild(audio);
        
        // Add event listeners for better mobile compatibility
        audio.addEventListener('loadstart', function() {
            console.log('Audio loading started');
        });
        
        audio.addEventListener('canplay', function() {
            console.log('Audio can start playing');
        });
        
        audio.addEventListener('error', function(e) {
            console.error('Audio error:', e);
            alert('Error loading audio. Please check if the file is accessible.');
            updatePlayerUI(false);
        });
        
        audio.addEventListener('ended', function() {
            updatePlayerUI(false);
        });
    }

    // Set source and play
    audio.src = url;
    
    // For mobile compatibility, we need user interaction
    const playPromise = audio.play();
    
    if (playPromise !== undefined) {
        playPromise.then(() => {
            console.log('Audio started playing');
            currentAudio = audio;
            updatePlayerUI(true);
        }).catch(error => {
            console.error('Error playing audio:', error);
            updatePlayerUI(false);
        });
    }
}

function pauseMeditation() {
    if (currentAudio) {
        currentAudio.pause();
        updatePlayerUI(false);
    }
}

function stopMeditation() {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
    }
    
    const player = document.getElementById('meditation-player');
    player.classList.remove('active');
    
    updatePlayerUI(false);
}

function updatePlayerUI(isPlaying) {
    const playOverlay = document.querySelector('.play-overlay');
    const playButtons = document.querySelectorAll('.control-btn');
    
    if (isPlaying) {
        if (playOverlay) playOverlay.style.display = 'none';
        // Update button states to show playing
        playButtons.forEach(btn => {
            if (btn.textContent.includes('Play')) {
                btn.innerHTML = '⏸️ Playing...';
                btn.style.opacity = '0.7';
            }
        });
    } else {
        if (playOverlay) playOverlay.style.display = 'flex';
        // Reset button states
        playButtons.forEach(btn => {
            if (btn.textContent.includes('Playing')) {
                btn.innerHTML = '▶️ Play';
                btn.style.opacity = '1';
            }
        });
    }
}

// Helper functions (you may already have these)
function getReadableName(type) {
    const names = {
        'selflove': '3D Self Love Neural Practice',
        'stress': 'Stress Relief Neural Practice',
        'breath': '3 Deep Breath Technique',
        'depression': 'Relieve Depression & Anxiety',
        'mindfulness': 'Mindfulness Relaxation Guided'
    };
    return names[type] || 'Meditation';
}

function getOrdinalSuffix(num) {
    const j = num % 10;
    const k = num % 100;
    if (j == 1 && k != 11) return 'st';
    if (j == 2 && k != 12) return 'nd';
    if (j == 3 && k != 13) return 'rd';
    return 'th';
}

function showArcanaSelection() {
    document.getElementById('arcana-modal').style.display = 'block';
}

function closeArcanaModal() {
    document.getElementById('arcana-modal').style.display = 'none';
}

function getReadableName(type) {
    const names = {
        'selflove': '3D Self Love Neural Practice',
        'stress': 'Stress Relief Neural Practice',
        'breath': '3 Deep Breath Technique',
        'depression': 'Relieve Depression & Anxiety',
        'mindfulness': 'Mindfulness Relaxation Guided'
    };
    return names[type] || type;
}

function showArcanaSelection() {
    document.getElementById('arcana-modal').style.display = 'block';
}

function closeArcanaModal() {
    document.getElementById('arcana-modal').style.display = 'none';
}

function getOrdinalSuffix(num) {
    const suffixes = ['th', 'st', 'nd', 'rd'];
    const v = num % 100;
    return suffixes[(v - 20) % 10] || suffixes[v] || suffixes[0];
}


function getRandomMessage() {
    if (allMessages.length === 0) return "Loading messages...";
    
    // Reset if all messages used
    if (usedMessages.length >= allMessages.length) {
        usedMessages = [];
    }
    
    // Get unused message
    let availableMessages = allMessages.filter((msg, index) => !usedMessages.includes(index));
    let randomIndex = Math.floor(Math.random() * availableMessages.length);
    let selectedMessage = availableMessages[randomIndex];
    
    // Mark as used
    let originalIndex = allMessages.indexOf(selectedMessage);
    usedMessages.push(originalIndex);
    
    return selectedMessage;
}
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const page = document.getElementById(pageId);
if (page) {
  page.classList.add('active');
} else {
  console.warn(`showPage: No element with id "${pageId}" found.`);
}
        
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    // Remove the nav-item activation line since action cards aren't nav items
}

// Helper function to convert display name to key - REPLACE THE ENTIRE FUNCTION
function getAffirmationKey(displayName) {
    const keyMap = {
        "Think Positively": "think-positively",
        "Build Self-Confidence": "build-self-confidence", 
        "Calm Your Anxiety": "calm-your-anxiety",
        "Nurture Self-Love": "nurture-self-love",
        "Express Gratitude": "express-gratitude",
        "Achieve Success": "achieve-success",
        "Ignite Motivation": "ignite-motivation",
        "Accept Yourself": "accept-yourself",
        "Love Your Body": "love-your-body",
        "Accept Your Parents and Ancestral Bloodline Power": "embrace-ancestry",
        "Embrace Changes": "embrace-changes",
        "Gain Balance in Life": "gain-balance",
        "Build Wealth": "build-wealth",
        "Lose Weight": "lose-weight",
        "Quit Smoking": "quit-smoking",
        "Fight with Depression": "fight-depression",
        "Forgive and Let Go": "forgive-and-let-go",
        "Conquer Loneliness": "conquer-loneliness",
        "Overcome Toxic Relationships": "overcome-toxic-relationships",
        "Forge New Connections": "forge-new-connections",
        "Nurture Sexuality": "nurture-sexuality",
        "Manifest New Love": "manifest-new-love",
        "Deal with Postpartum": "cherish-your-pregnancy",
        "Awaken Spiritually": "awaken-spiritually",
        "Harness the Law of Attraction": "harness-law-of-attraction",
        "Heal From Grief": "heal-from-grief",
        "Fuel Vitality": "fuel-vitality",
        "Adopt Stoic Mindset": "adopt-stoic-mindset",
        "Inspire as a Leader": "inspire-as-leader",
        "Elevate Career": "elevate-career"
    };
    return keyMap[displayName];
}


// Load messages when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadMessages();
    document.getElementById('home-page').classList.add('active');

});

// Navigation for action cards and footer menu
document.addEventListener('DOMContentLoaded', function() {
    // Action cards on home page
    document.querySelectorAll('.action-card').forEach(card => {
        card.addEventListener('click', function() {
            const pageId = this.getAttribute('data-page');
            if (pageId) {
                showPage(pageId + '-page');
            }
        });
    });
    
    // Footer navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
            const pageId = this.getAttribute('data-page');
            if (pageId) {
                showPage(pageId);
            }
        });
    });
});
</script>
<script>
    // Register service worker for PWA

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Hide loading screen when app loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }, 2000);
        });

        
        // Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installBtn = document.createElement('button');
            installBtn.innerHTML = '📱 Install App';
            installBtn.className = 'install-prompt';
            installBtn.style.cssText = `
                position: fixed;
                bottom: 100px;
                right: 20px;
                background: #ccae79;
                color: #4c135d;
                border: none;
                padding: 12px 20px;
                border-radius: 25px;
                font-weight: bold;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: pulse 2s infinite;
            `;
            
            installBtn.addEventListener('click', async () => {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                installBtn.remove();
            });
            
            document.body.appendChild(installBtn);
        });

        // Add pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
        
        // Affirmations functionality
class AffirmationsManager {
    constructor() {
        this.selectedCategories = new Set();
        this.settings = {
            days: [],
            frequency: 1,
            startTime: '09:00'
        };
        this.init();
    }

    init() {
        this.loadSavedSettings();
        this.bindEvents();
        this.updateSelectedDisplay();
        
        // Check immediately and after DOM is ready
        this.checkAndHideCompletedSetup();
        
        // Add longer delay to ensure all elements are loaded
        setTimeout(() => {
            this.checkAndHideCompletedSetup();
        }, 500);
    }

    loadSavedSettings() {
        const saved = localStorage.getItem('affirmationSettings');
        if (saved) {
            const data = JSON.parse(saved);
            
            // Load categories
            data.categories.forEach(category => {
                this.selectedCategories.add(category);
                const categoryCard = document.querySelector(`[data-category="${category}"]`);
                if (categoryCard) {
                    categoryCard.classList.add('selected');
                }
            });
            
            // Load days
            data.days.forEach(day => {
                const checkbox = document.getElementById(`day-${day}`);
                if (checkbox) checkbox.checked = true;
            });
            this.settings.days = data.days;
            
            // Load frequency and start time
            this.settings.frequency = data.frequency;
            this.settings.startTime = data.startTime;
            
            const frequencySelect = document.getElementById('frequency-select');
            const startTimeInput = document.getElementById('start-time');
            
            if (frequencySelect) frequencySelect.value = data.frequency;
            if (startTimeInput) startTimeInput.value = data.startTime;
            
            this.updatePreview();
        }
    }

    bindEvents() {
        // Category selection
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', (e) => this.toggleCategory(e));
        });
        
        // Day checkboxes
        document.querySelectorAll('.day-checkbox input').forEach(checkbox => {
            checkbox.addEventListener('change', () => this.updateDays());
        });
        
        // Frequency selection
        const frequencySelect = document.getElementById('frequency-select');
        if (frequencySelect) {
            frequencySelect.addEventListener('change', (e) => {
                this.settings.frequency = parseInt(e.target.value);
                this.updatePreview();
            });
        }
        
        // Start time
        const startTimeInput = document.getElementById('start-time');
        if (startTimeInput) {
            startTimeInput.addEventListener('change', (e) => {
                this.settings.startTime = e.target.value;
                this.updatePreview();
            });
        }
        
        // Save button
        const saveButton = document.getElementById('save-settings');
        if (saveButton) {
            saveButton.addEventListener('click', () => this.saveSettings());
        }
        
        // Setup reminders button
        const setupButton = document.getElementById('setup-reminders-btn');
        if (setupButton) {
            setupButton.addEventListener('click', () => {
                const notificationSetup = document.querySelector('.notification-setup');
                if (notificationSetup) {
                    notificationSetup.style.display = 'block';
                }
            });
        }
    }

  toggleCategory(e) {
    const card = e.currentTarget;
    const category = card.dataset.category;
    
    if (!category) return;
    
    if (this.selectedCategories.has(category)) {
        this.selectedCategories.delete(category);
        card.classList.remove('selected');
    } else {
        this.selectedCategories.add(category);
        card.classList.add('selected');
    }
    
    this.updateSelectedDisplay();
    this.saveToLocalStorage();

    // SHOW the buttons **ONLY** when user changes selections
    const setupButtonContainer = document.querySelector('.setup-button-container');
    if (setupButtonContainer) {
        setupButtonContainer.style.display = 'block';
    }
    const notificationSetup = document.querySelector('.notification-setup');
    if (notificationSetup) {
        notificationSetup.style.display = 'block';
    }
}

    updateSelectedDisplay() {
        const selectedList = document.getElementById('selected-list');
        const selectedContainer = document.querySelector('.selected-categories');
        const setupButtonContainer = document.querySelector('.setup-button-container');
        const notificationElements = [
            document.querySelector('.days-selection'),
            document.querySelector('.frequency-selection'),
            document.querySelector('.start-time-selection'),
            document.getElementById('save-settings'),
            document.getElementById('schedule-preview')
        ];

        if (this.selectedCategories.size > 0) {
            if (selectedContainer) selectedContainer.classList.add('show');
            if (setupButtonContainer) setupButtonContainer.style.display = 'show';

            // Show all notification setup elements
            notificationElements.forEach(el => {
                if (el) el.classList.add('show');
            });
            
            if (selectedList) {
                selectedList.innerHTML = '';
                
                this.selectedCategories.forEach(category => {
                    const tag = document.createElement('div');
                    tag.className = 'selected-tag';
                    tag.innerHTML = `
                        ${category}
                        <span class="remove" data-category="${category}">×</span>
                    `;
                    
                    tag.querySelector('.remove').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.removeCategory(category);
                    });
                    
                    selectedList.appendChild(tag);
                });
            }
        } else {
            if (selectedContainer) selectedContainer.classList.remove('show');
            if (setupButtonContainer) setupButtonContainer.style.display = 'show';

            // Hide all notification setup elements
            notificationElements.forEach(el => {
                if (el) el.classList.remove('show');
            });
        }
    }

    removeCategory(category) {
        this.selectedCategories.delete(category);
        const categoryCard = document.querySelector(`[data-category="${category}"]`);
        if (categoryCard) {
            categoryCard.classList.remove('selected');
        }
        this.updateSelectedDisplay();
        this.saveToLocalStorage();
        
        // Hide notification setup if no categories selected
        if (this.selectedCategories.size === 0) {
            const notificationSetup = document.querySelector('.notification-setup');
            if (notificationSetup) {
                notificationSetup.classList.remove('show');
            }
        }
    }

    updateDays() {
        this.settings.days = [];
        document.querySelectorAll('.day-checkbox input:checked').forEach(checkbox => {
            this.settings.days.push(checkbox.value);
        });
        this.updatePreview();
    }

    updatePreview() {
        const previewContent = document.getElementById('preview-content');
        const schedulePreview = document.getElementById('schedule-preview');
        
        if (this.settings.days.length > 0 && this.selectedCategories.size > 0) {
            if (schedulePreview) schedulePreview.style.display = 'block';
            
            const times = this.generateScheduleTimes();
            const daysText = this.settings.days.join(', ');
            const categoriesText = Array.from(this.selectedCategories).join(', ');
            
            if (previewContent) {
                previewContent.innerHTML = `
                    <p><strong>Days:</strong> ${daysText}</p>
                    <p><strong>Categories:</strong> ${categoriesText}</p>
                    <p><strong>Times:</strong> ${times.join(', ')}</p>
                    <p><strong>Frequency:</strong> Every ${this.settings.frequency} hour(s)</p>
                `;
            }
        } else {
            if (schedulePreview) schedulePreview.style.display = 'none';
        }
    }

    generateScheduleTimes() {
        const times = [];
        const [startHour, startMinute] = this.settings.startTime.split(':').map(Number);
        let currentHour = startHour;
        
        // Generate times for a day (max 24 hours)
        while (currentHour < 24) {
            const timeString = `${currentHour.toString().padStart(2, '0')}:${startMinute.toString().padStart(2, '0')}`;
            times.push(timeString);
            currentHour += this.settings.frequency;
        }
        
        return times;
    }


    async saveSettings() {
    // Your existing validation
    if (this.selectedCategories.size === 0) {
        this.showMessage('Please select at least one category!', 'error');
        return;
    }

    if (this.settings.days.length === 0) {
        this.showMessage('Please select at least one day!', 'error');
        return;
    }

    const settingsData = {
        categories: Array.from(this.selectedCategories),
        days: this.settings.days,
        frequency: this.settings.frequency,
        startTime: this.settings.startTime,
        setupComplete: true,
        savedAt: new Date().toISOString()
    };

    localStorage.setItem('affirmationSettings', JSON.stringify(settingsData));

    // FIX: Get userId properly and add error handling
    try {
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        // Wait for authentication to complete
if (!window.currentUser) {
    console.log('Waiting for user authentication...');
    for (let i = 0; i < 30; i++) {
        await new Promise(resolve => setTimeout(resolve, 100));
        if (window.currentUser) break;
    }
}

if (window.currentUser) {
    await window.saveUserPreferences(window.currentUser.uid, settingsData.categories, {
        days: settingsData.days,
        frequency: settingsData.frequency,
        startTime: settingsData.startTime
    });
    console.log('Successfully saved to Firebase!');
} else {
    console.error('No authenticated user found after waiting');
    this.showMessage('Please sign in to save your preferences to the cloud', 'error');
    return;
}
} catch (error) {
    console.error('Error saving to Firebase:', error);
    this.showMessage('Settings saved locally, but cloud sync failed', 'warning');
}


    this.showMessage('Your preferences have been saved successfully! 🎉', 'success');

    // Schedule notifications if supported
    this.scheduleNotifications();

    // Wait 4 seconds before hiding windows so user can see the success message and preview
    setTimeout(() => {
        this.hideSetupElements();
    }, 4000);
}


    saveToLocalStorage() {
        const quickSave = {
            categories: Array.from(this.selectedCategories)
        };
        localStorage.setItem('selectedCategories', JSON.stringify(quickSave));
    }

    showMessage(message, type = 'success') {
        // Remove existing messages
        const existingMessage = document.querySelector('.settings-message');
        if (existingMessage) {
            existingMessage.remove();
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `settings-message ${type}`;
        messageDiv.innerHTML = message;
        
        const saveButton = document.getElementById('save-settings');
        if (saveButton && saveButton.parentNode) {
            saveButton.parentNode.insertBefore(messageDiv, saveButton.nextSibling);
        }
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    async scheduleNotifications() {
    if ('Notification' in window) {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
            console.log('Notification permission granted for:', this.settings);

            // Show a test notification immediately
            new Notification('Affirmations app', {
                body: 'Your daily affirmations reminders are set! 🎉',
                icon: 'icon.png' // optional, add your app icon path
            });

            // Future: integrate with service worker for scheduling
            // You can add service worker registration here if you want
        } else {
            console.log('Notification permission denied.');
        }
    } else {
        console.log('Notifications not supported in this browser.');
    }


    }

    checkAndHideCompletedSetup() {
        console.log('Checking for completed setup...');
        const saved = localStorage.getItem('affirmationSettings');
        console.log('Saved settings:', saved);
        
        if (saved) {
            try {
                const parsedSettings = JSON.parse(saved);
                // Check if settings are actually complete (has days and other required fields)
                if (parsedSettings.days && parsedSettings.days.length > 0 && parsedSettings.setupComplete) {
                    console.log('Complete settings found, hiding elements...');
                    this.hideSetupElements();
                } else {
                    console.log('Settings exist but incomplete');
                }
            } catch (error) {
                console.error('Error parsing saved settings:', error);
            }
        } else {
            console.log('No saved settings found');
        }
    }

   hideSetupElements() {
    const setupButtonContainer = document.querySelector('.setup-button-container');
    if (setupButtonContainer) {
        // Hide buttons by setting display to none (or use a class)
        setupButtonContainer.style.display = 'none';
        console.log('Setup button hidden');
    }

    // Similarly for notification setup
    const notificationSetup = document.querySelector('.notification-setup');
    if (notificationSetup) {
        notificationSetup.style.display = 'none';
        console.log('Notification setup hidden');
    }

    // Hide selected categories container if needed
    const selectedContainer = document.querySelector('.selected-categories');
    if (selectedContainer) {
        selectedContainer.style.display = 'none';
        console.log('Selected categories hidden');
    }
}



    // Add method to reset setup (for testing)
    resetSetup() {
        localStorage.removeItem('affirmationSettings');
        localStorage.removeItem('selectedCategories');
        location.reload();
    }

    // Method to get random affirmation from selected categories
    getRandomAffirmation() {
        if (this.selectedCategories.size === 0) return null;
        
        const categories = Array.from(this.selectedCategories);
        const randomCategory = categories[Math.floor(Math.random() * categories.length)];
        
        // This will connect to your affirmations data
        return this.getAffirmationFromCategory(randomCategory);
    }

    // Placeholder for connecting to your affirmations data
    getAffirmationFromCategory(category) {
        // This method will be updated once you share your affirmations.js structure
        console.log(`Getting affirmation from category: ${category}`);
        return `Sample affirmation from ${category}`;
    }
}
// Generate and store a unique userId if not already saved
let userId = localStorage.getItem('userId');
if (!userId) {
  userId = 'user_' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('userId', userId);
}
// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.affirmationsManager = new AffirmationsManager();
});


// Calculator functionality
let currentCalculator = '';

function showCodeInput(calculatorType) {
    currentCalculator = calculatorType;
    document.getElementById('code-modal').style.display = 'block';
}

function closeCodeModal() {
    document.getElementById('code-modal').style.display = 'none';
    document.getElementById('access-code-input').value = '';
}

function validateCode() {
    const code = document.getElementById('access-code-input').value.trim();
    const validCodes = {
        'money-code': 'wealthcode455',
        'forecast': 'vision775'
    };

    if (code === validCodes[currentCalculator]) {
        unlockCalculator(currentCalculator);
        closeCodeModal();
        alert('Calculator unlocked! 🎉');
    } else {
        alert('Invalid code. Please try again.');
    }
}

function unlockCalculator(calculatorType) {
    const card = document.querySelector(`[data-calculator="${calculatorType}"]`);
    if (!card) {
        console.error(`No card found for calculator type: ${calculatorType}`);
        return;
    }

    const lockOverlay = card.querySelector('.lock-overlay');
    if (lockOverlay) {
        lockOverlay.style.display = 'none';
    }

    // Save unlocked status
    localStorage.setItem(`calculator-${calculatorType}`, 'unlocked');

    // Add click listener once (optional: avoid duplicates)
    if (!card.dataset.listenerAttached) {
        card.addEventListener('click', () => showEmbeddedCalculator(calculatorType));
        card.dataset.listenerAttached = 'true';
    }

    // Show embedded calculator immediately
    showEmbeddedCalculator(calculatorType);
}

function showEmbeddedCalculator(calculatorType) {
    if (document.getElementById(`embedded-${calculatorType}`)) return;

    const calculatorUrls = {
        'money-code': 'https://money-code-calculator.vercel.app/',
        'forecast': 'https://forecast-calculator-ochre.vercel.app/'
    };

    const calculatorNames = {
        'money-code': '💰 Money Code Calculator',
        'forecast': '🔮 Forecast Calculator'
    };

    const calculatorContainer = document.createElement('div');
    calculatorContainer.id = `embedded-${calculatorType}`;
    calculatorContainer.className = 'embedded-calculator';
    calculatorContainer.innerHTML = `
        <div class="calculator-header">
            <h2>${calculatorNames[calculatorType]}</h2>
            <button class="close-calculator" onclick="closeEmbeddedCalculator('${calculatorType}')">×</button>
        </div>
        <div class="calculator-iframe-container">
            <iframe src="${calculatorUrls[calculatorType]}" 
                    frameborder="0" 
                    width="100%" 
                    height="600px"
                    style="border-radius: 10px;">
            </iframe>
        </div>
    `;

    document.body.appendChild(calculatorContainer);
    calculatorContainer.style.display = 'block';
}

function closeEmbeddedCalculator(calculatorType) {
    const calculator = document.getElementById(`embedded-${calculatorType}`);
    if (calculator) {
        calculator.remove();
    }
}

function checkAndHideCompletedSetup() {
    console.log('Checking for completed setup...');
    const saved = localStorage.getItem('affirmationSettings');
    console.log('Saved settings:', saved);
    
    if (saved) {
        console.log('Settings found, hiding elements...');
        
        // Hide the setup button container
        const setupButtonContainer = document.querySelector('.setup-button-container');
        console.log('Setup button container:', setupButtonContainer);
       if (setupButtonContainer) {
    setupButtonContainer.classList.remove('show');
    console.log('Setup button hidden');
}
        
        // Hide the selected categories container
        const selectedContainer = document.querySelector('.selected-categories');
        console.log('Selected container:', selectedContainer);
        if (selectedContainer) {
            selectedContainer.style.display = 'none';
            console.log('Selected categories hidden');
        }
        
        // Hide the notification setup window
        const notificationSetup = document.querySelector('.notification-setup');
        console.log('Notification setup:', notificationSetup);
        if (notificationSetup) {
            notificationSetup.style.display = 'none';
            console.log('Notification setup hidden');
        }
    } else {
        console.log('No saved settings found');
    }
}

function forceFixLifemap() {
    console.log('Attempting to fix lifemap...');
    const lifemapPage = document.getElementById('lifemap-page');
    const bottomNav = document.querySelector('.bottom-nav');
    
    if (lifemapPage && lifemapPage.classList.contains('active')) {
        // Force page positioning with space for bottom nav
        lifemapPage.style.position = 'absolute';
lifemapPage.style.top = '0';
lifemapPage.style.left = '50%';
lifemapPage.style.transform = 'translateX(-50%)';
lifemapPage.style.height = 'auto';
lifemapPage.style.minHeight = '100vh';

        lifemapPage.style.width = '100%';
        lifemapPage.style.height = 'auto';
        lifemapPage.style.maxWidth = '400px';
        lifemapPage.style.margin = '0 auto';
lifemapPage.style.zIndex = '9999';
lifemapPage.style.padding = '0px 15px 120px 15px';
lifemapPage.style.paddingTop = '0';
lifemapPage.style.marginTop = '0';

lifemapPage.style.overflowY = 'auto';
lifemapPage.style.background = 'linear-gradient(135deg, #4c135d 0%, #6b2c91 100%)';

// Force header to top with no gap
const header = lifemapPage.querySelector('.page-header');
if (header) {
    header.style.marginTop = '0';
    header.style.paddingTop = '20px';
}

// ADD THIS NEW PART:
// Force lifemap-content container to have no gap
const lifemapContent = lifemapPage.querySelector('.lifemap-content');
if (lifemapContent) {
    lifemapContent.style.marginTop = '0';
    lifemapContent.style.paddingTop = '0';
}


// Force all children to have no top margin/padding
const lifemapChildren = lifemapPage.children;
for (let i = 0; i < lifemapChildren.length; i++) {
    if (i === 0) { // First child (header)
        lifemapChildren[i].style.marginTop = '0';
        lifemapChildren[i].style.paddingTop = '20px';
    } else {
        lifemapChildren[i].style.marginTop = '0';
        lifemapChildren[i].style.paddingTop = '0';
    }
}


        
        // Force the bottom nav to show properly
        forceShowBottomNav();
        
        // Re-initialize navigation to ensure it still works
        setTimeout(() => {
            reinitializeAllNavigation();
        }, 100);
        
        console.log('Lifemap styling applied with bottom nav restored');
    }
}


function forceShowBottomNav() {
    const bottomNav = document.querySelector('.bottom-nav');
    if (bottomNav) {
        // Force all possible ways to show it
        bottomNav.style.display = 'flex';
        bottomNav.style.visibility = 'visible';
        bottomNav.style.opacity = '1';
        bottomNav.style.transform = 'none';
        bottomNav.style.pointerEvents = 'auto';
        bottomNav.style.position = 'fixed';
        bottomNav.style.bottom = '0';
        bottomNav.style.left = '0';
        bottomNav.style.right = '0';
        bottomNav.style.zIndex = '10000'; // Higher than lifemap page
        bottomNav.style.background = '#4c135d'; // Add background if needed
        console.log('Bottom nav forced to show');
    }
}

// Auto-run the lifemap fix when page loads and when switching pages
document.addEventListener('DOMContentLoaded', function() {
    // Check every 500ms for lifemap page
    setInterval(function() {
        const lifemapPage = document.getElementById('lifemap-page');
        if (lifemapPage && lifemapPage.classList.contains('active')) {
            forceFixLifemap();
        }
    }, 500);
});

// Also run immediately
setTimeout(forceFixLifemap, 1000);

// Bottom Navigation Handler
function initializeBottomNavigation() {
    const navItems = document.querySelectorAll('.bottom-nav .nav-item');
    
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const targetPage = this.getAttribute('data-page');
            console.log('Nav item clicked:', targetPage);
            
            // Remove active class from all nav items
            navItems.forEach(nav => nav.classList.remove('active'));
            
            // Add active class to clicked item
            this.classList.add('active');
            
            // Navigate to the target page
            navigateToPage(targetPage);
        });
    });
}

// Home Page Action Cards Handler
function initializeHomePageActions() {
    const actionCards = document.querySelectorAll('.action-card');
    
    actionCards.forEach(card => {
        card.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const targetPage = this.getAttribute('data-page');
            console.log('Action card clicked:', targetPage);
            
            // Update bottom nav active state
            const navItems = document.querySelectorAll('.bottom-nav .nav-item');
            navItems.forEach(nav => nav.classList.remove('active'));
            
            const correspondingNavItem = document.querySelector(`.bottom-nav .nav-item[data-page="${targetPage}"]`);
            if (correspondingNavItem) {
                correspondingNavItem.classList.add('active');
            }
            
            // Navigate to the target page
            navigateToPage(targetPage);
        });
    });
}

// Navigation function
function navigateToPage(pageName) {
    console.log('Navigating to:', pageName);
    
    // Hide all pages first
    const allPages = document.querySelectorAll('.page');
    allPages.forEach(page => {
        page.classList.remove('active');
        page.style.display = 'none';
    });
    
    // Show the target page
    let targetPageElement;
    
    switch(pageName) {
        case 'home':
            targetPageElement = document.getElementById('home-page') || document.querySelector('.page[data-page="home"]');
            break;
        case 'meditations':
            targetPageElement = document.getElementById('meditations-page') || document.querySelector('.page[data-page="meditations"]');
            break;
        case 'lifemap':
            targetPageElement = document.getElementById('lifemap-page') || document.querySelector('.page[data-page="lifemap"]');
            break;
        case 'affirmations':
            targetPageElement = document.getElementById('affirmations-page') || document.querySelector('.page[data-page="affirmations"]');
            break;
        case 'calculators':
            targetPageElement = document.getElementById('calculators-page') || document.querySelector('.page[data-page="calculators"]');
            break;
        default:
            console.log('Page not found:', pageName);
            return;
    }
    
    if (targetPageElement) {
        targetPageElement.style.display = 'block';
        targetPageElement.classList.add('active');
        console.log('Successfully navigated to:', pageName);
        
        // Special handling for lifemap page
        if (pageName === 'lifemap') {
            setTimeout(() => {
                forceFixLifemap();
            }, 100);
        }
    } else {
        console.error('Target page element not found for:', pageName);
    }
}

// Enhanced forceShowBottomNav to ensure clickability
function forceShowBottomNav() {
    const bottomNav = document.querySelector('.bottom-nav');
    if (bottomNav) {
        // Force all possible ways to show it and make it clickable
        bottomNav.style.display = 'flex';
        bottomNav.style.visibility = 'visible';
        bottomNav.style.opacity = '1';
        bottomNav.style.transform = 'none';
        bottomNav.style.pointerEvents = 'auto';
        bottomNav.style.position = 'fixed';
        bottomNav.style.bottom = '0';
        bottomNav.style.left = '0';
        bottomNav.style.right = '0';
        bottomNav.style.zIndex = '10000';
        bottomNav.style.background = '#4c135d';
        
        // Ensure nav items are also clickable
        const navItems = bottomNav.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.style.pointerEvents = 'auto';
            item.style.cursor = 'pointer';
        });
        
        console.log('Bottom nav forced to show and made clickable');
    }
}

// Re-initialize all navigation handlers
function reinitializeAllNavigation() {
    console.log('Re-initializing all navigation...');
    initializeBottomNavigation();
    initializeHomePageActions();
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing navigation systems...');
    
    // Initialize both navigation systems
    initializeBottomNavigation();
    initializeHomePageActions();
    
    // Set home as active by default
    const homeNavItem = document.querySelector('.nav-item[data-page="home"]');
    if (homeNavItem) {
        homeNavItem.classList.add('active');
    }
    
    // Check every 500ms for lifemap page and ensure nav works
    setInterval(function() {
        const lifemapPage = document.getElementById('lifemap-page');
        if (lifemapPage && lifemapPage.classList.contains('active')) {
            forceFixLifemap();
        }
        
        // Ensure action cards are still clickable
        const actionCards = document.querySelectorAll('.action-card');
        actionCards.forEach(card => {
            if (!card.hasAttribute('data-nav-initialized')) {
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const targetPage = this.getAttribute('data-page');
                    navigateToPage(targetPage);
                });
                card.setAttribute('data-nav-initialized', 'true');
            }
        });
    }, 500);
});

// Also run immediately with delay
setTimeout(() => {
    reinitializeAllNavigation();
    forceFixLifemap();
}, 1000);

// Additional initialization after 2 seconds to catch any delayed elements
setTimeout(() => {
    reinitializeAllNavigation();
}, 2000);


// Meditation Progress Functions
function loadMeditationProgress() {
    const totalMinutes = parseInt(localStorage.getItem('totalMeditationMinutes') || '0');
    const totalSessions = parseInt(localStorage.getItem('totalMeditationSessions') || '0');
    const totalHours = Math.floor(totalMinutes / 60);
    
    document.getElementById('meditation-minutes').textContent = totalMinutes;
    document.getElementById('meditation-hours').textContent = totalHours;
    document.getElementById('meditation-sessions').textContent = totalSessions;
}

function updateMeditationProgress(minutes) {
    const currentMinutes = parseInt(localStorage.getItem('totalMeditationMinutes') || '0');
    const currentSessions = parseInt(localStorage.getItem('totalMeditationSessions') || '0');
    
    localStorage.setItem('totalMeditationMinutes', (currentMinutes + minutes).toString());
    localStorage.setItem('totalMeditationSessions', (currentSessions + 1).toString());
    
    console.log(`Meditation progress updated: +${minutes} minutes`);
}

// Affirmation Settings Functions
function loadAffirmationSettings() {
    const affirmations = JSON.parse(localStorage.getItem('scheduledAffirmations') || '[]');
    const affirmationList = document.getElementById('affirmation-list');
    const noAffirmations = document.getElementById('no-affirmations');
    
    if (affirmations.length === 0) {
        affirmationList.style.display = 'none';
        noAffirmations.style.display = 'block';
        return;
    }
    
    affirmationList.style.display = 'block';
    noAffirmations.style.display = 'none';
    
    affirmationList.innerHTML = affirmations.map(affirmation => `
        <div class="affirmation-item">
            <div class="affirmation-category">${affirmation.category}</div>
            <div class="affirmation-text">"${affirmation.text}"</div>
            <div class="affirmation-schedule">
                <span>⏰</span>
                <span>${affirmation.schedule || 'Daily reminder set'}</span>
            </div>
        </div>
    `).join('');
}

function saveAffirmationSetting(category, text, schedule) {
    const affirmations = JSON.parse(localStorage.getItem('scheduledAffirmations') || '[]');
    
    // Check if affirmation already exists
    const existingIndex = affirmations.findIndex(a => a.text === text);
    
    if (existingIndex >= 0) {
        // Update existing
        affirmations[existingIndex] = { category, text, schedule };
    } else {
        // Add new
        affirmations.push({ category, text, schedule });
    }
    
    localStorage.setItem('scheduledAffirmations', JSON.stringify(affirmations));
    console.log('Affirmation setting saved:', { category, text, schedule });
}

// Initialize profile settings
document.addEventListener('DOMContentLoaded', function() {
    loadProfilePhoto();
    
    // You can call updateMeditationProgress() from your meditation completion functions
    // You can call saveAffirmationSetting() from your affirmation reminder setup
});

// Profile Menu Functions
function toggleProfileMenu() {
    const menu = document.getElementById('profile-menu'); // This should match now
    menu.classList.remove('hidden');
}

function closeProfileMenu() {
    const menu = document.getElementById('profile-menu'); // This should match now
    menu.classList.add('hidden');
}




function changeProfilePicture() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                document.getElementById('profile-image').src = imageUrl;
                localStorage.setItem('profileImage', imageUrl);
                showMessage('✨ Profile picture updated!');
            };
            reader.readAsDataURL(file);
        }
    };
    input.click();
    closeProfileMenu(); // Updated to use closeProfileMenu
}

function openNotificationSettings() {
    closeProfileMenu(); // Updated to use closeProfileMenu
    showNotificationModal();
}


function closeNotificationModal() {
    const modal = document.getElementById('notification-modal');
    if (modal) modal.remove();
}

function selectAffirmationCategories() {
    closeNotificationModal();
    showPage('affirmations');
}

function loadNotificationSettings() {
    // Load notification toggle state
    const notificationsEnabled = localStorage.getItem('notificationsEnabled') === 'true';
    const toggle = document.getElementById('notifications-enabled');
    const status = document.getElementById('notification-status');
    
    if (toggle) {
        toggle.checked = notificationsEnabled && Notification.permission === 'granted';
        
        if (notificationsEnabled && Notification.permission === 'granted') {
            status.textContent = '✅ Notifications enabled! You\'ll receive daily affirmations';
        } else {
            status.textContent = 'Enable notifications to receive daily affirmations';
        }
    }
    
    // Load meditation progress
    const totalMinutes = parseInt(localStorage.getItem('totalMeditationMinutes') || '0');
    const totalSessions = parseInt(localStorage.getItem('totalMeditationSessions') || '0');
    const totalHours = Math.floor(totalMinutes / 60);
    
    document.getElementById('profile-meditation-hours').textContent = totalHours;
    document.getElementById('profile-meditation-sessions').textContent = totalSessions;
    
    // Load selected categories from affirmation page
    const selectedCategories = JSON.parse(localStorage.getItem('selectedAffirmationCategories') || '[]');
    
    const categoriesDisplay = document.getElementById('selected-categories-display');
    if (selectedCategories.length > 0) {
        categoriesDisplay.innerHTML = selectedCategories.map(cat => 
            `<span class="category-tag">${cat}</span>`
        ).join('');
    } else {
        categoriesDisplay.innerHTML = '<p style="color: #666; font-style: italic;">No categories selected yet. Go to Affirmations page to choose.</p>';
    }
    
    document.getElementById('active-affirmations-count').textContent = selectedCategories.length;
    
    // Load wishes count
    const wishes = JSON.parse(localStorage.getItem('savedWishes') || '[]');
    document.getElementById('saved-wishes-count').textContent = wishes.length;
    
    // Load favorite meditation type
    const meditationStats = JSON.parse(localStorage.getItem('meditationStats') || '{}');
    const favorite = Object.keys(meditationStats).length > 0 ? 
        Object.keys(meditationStats).reduce((a, b) => meditationStats[a] > meditationStats[b] ? a : b) : 
        'Not set';
    document.getElementById('favorite-meditation').textContent = favorite;
    
    // Calculate days active
    const firstUse = localStorage.getItem('firstUseDate');
    if (firstUse) {
        const daysDiff = Math.floor((new Date() - new Date(firstUse)) / (1000 * 60 * 60 * 24));
        document.getElementById('days-active').textContent = daysDiff + 1;
    } else {
        localStorage.setItem('firstUseDate', new Date().toISOString());
        document.getElementById('days-active').textContent = '1';
    }
}


// Wishes Functionality
function openWishesBoard() {
    toggleProfileMenu(); // Close profile menu
    document.getElementById('wishes-modal').classList.remove('hidden');
    document.getElementById('wishes-text').value = '';
    document.getElementById('wishes-text').focus();
}

function closeWishesModal() {
    document.getElementById('wishes-modal').classList.add('hidden');
}

function saveWish() {
    const wishText = document.getElementById('wishes-text').value.trim();
    if (!wishText) {
        showMessage('⚠️ Please write your wish first!');
        return;
    }
    
    const wishes = JSON.parse(localStorage.getItem('savedWishes') || '[]');
    const newWish = {
        id: Date.now(),
        text: wishText,
        date: new Date().toLocaleDateString(),
        timestamp: new Date().toISOString()
    };
    
    wishes.unshift(newWish);
    localStorage.setItem('savedWishes', JSON.stringify(wishes));
    
    // Clear the text area for new wish
    document.getElementById('wishes-text').value = '';
    
    // Show success message
    showMessage('✨ Your wish has been saved safely!');
}

function viewSavedWishes() {
    const wishes = JSON.parse(localStorage.getItem('savedWishes') || '[]');
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>✨ Your Saved Wishes</h3>
                <button class="close-modal" onclick="this.closest('.modal').remove()">×</button>
            </div>
            <div class="wishes-list">
                ${wishes.length === 0 ? 
                    '<p style="text-align: center; color: #666; font-style: italic;">No wishes saved yet. Write your first wish!</p>' :
                    wishes.map(wish => `
                        <div class="wish-item">
                            <div class="wish-date">${wish.date}</div>
                            <div class="wish-text">${wish.text}</div>
                        </div>
                    `).join('')
                }
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function openPersonalTools() {
    toggleProfileMenu();
    // You can expand this to show additional tools
    showMessage('🔧 Personal tools coming soon!');
}

// Meditation Integration
function trackMeditationCompletion(meditationType) {
    // Track 7 minutes per session
    updateMeditationProgress(7);
    
    // Track meditation type preferences
    const stats = JSON.parse(localStorage.getItem('meditationStats') || '{}');
    stats[meditationType] = (stats[meditationType] || 0) + 1;
    localStorage.setItem('meditationStats', JSON.stringify(stats));
    
    showMessage(`🧘 Great session! +7 minutes logged`);
}

// Enhanced meditation card click handler (continued)
document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers to meditation cards
    const meditationCards = document.querySelectorAll('.meditation-card');
    meditationCards.forEach(card => {
        const originalClick = card.onclick;
        card.addEventListener('click', function() {
            const meditationType = this.dataset.meditation;
            if (meditationType && meditationType !== 'personalized') {
                // Track that user started this meditation type
                trackMeditationStart(meditationType);
            }
            // Call original click handler if it exists
            if (originalClick) originalClick.call(this);
        });
    });

   // Initialize affirmation categories when page loads
function initializeAffirmationCategories() {
    const categoryCards = document.querySelectorAll('.category-card');
    console.log('Found category cards:', categoryCards.length); // Debug line
    
    categoryCards.forEach(card => {
        card.addEventListener('click', function() {
            console.log('Category clicked:', this.dataset.category); // Debug line
            toggleCategorySelection(this);
        });
    });
    
    // Load saved categories
    loadSavedCategories();
}

// Call this when navigating to affirmations page
function showAffirmationsPage() {
    // Your existing page navigation code
    // Then add:
    setTimeout(() => {
        initializeAffirmationCategories();
    }, 100);
}


    // Initialize profile
    initializeProfile();
});

function trackMeditationStart(meditationType) {
    // Store the start time and type
    localStorage.setItem('currentMeditation', JSON.stringify({
        type: meditationType,
        startTime: new Date().toISOString()
    }));
}

// Call this when meditation actually completes
function completeMeditation() {
    const current = JSON.parse(localStorage.getItem('currentMeditation') || '{}');
    if (current.type) {
        trackMeditationCompletion(current.type);
        localStorage.removeItem('currentMeditation');
    }
}

// Affirmation Categories Integration
function toggleCategorySelection(card) {
    const checkbox = card.querySelector('.checkbox');
    const category = card.dataset.category;
        
    // Toggle visual state
    card.classList.toggle('selected');
    checkbox.classList.toggle('checked');
        
    // Update selected categories and show/hide button
    updateSelectedCategories();
}

function updateSelectedCategories() {
    const selectedCards = document.querySelectorAll('.category-card.selected');
    const selectedList = document.getElementById('selected-list');
    const setupButton = document.querySelector('.setup-button-container');
        
    if (selectedCards.length > 0) {
        // Show selected categories
        selectedList.innerHTML = Array.from(selectedCards).map(card =>
            `<span class="selected-category">${card.dataset.category}</span>`
        ).join('');
                
        // Show setup button
        if (setupButton) setupButton.style.display = 'block';
                
        // Save to localStorage
        const categories = Array.from(selectedCards).map(card => card.dataset.category);
        localStorage.setItem('selectedAffirmationCategories', JSON.stringify(categories));
            
    } else {
        selectedList.innerHTML = '<p>No categories selected</p>';
        if (setupButton) setupButton.style.display = 'none';
    }
}


// Load saved affirmation categories
function loadSavedCategories() {
    const savedCategories = JSON.parse(localStorage.getItem('selectedAffirmationCategories') || '[]');
    
    savedCategories.forEach(category => {
        const card = document.querySelector(`[data-category="${category}"]`);
        if (card) {
            card.classList.add('selected');
            card.querySelector('.checkbox').classList.add('checked');
        }
    });
    
    updateSelectedCategories();
}

// Enhanced setup reminders functionality
document.addEventListener('DOMContentLoaded', function() {
    const setupBtn = document.getElementById('setup-reminders-btn');
    if (setupBtn) {
        setupBtn.addEventListener('click', function() {
            document.querySelector('.notification-setup').style.display = 'block';
            this.style.display = 'none';
        });
    }
    
    const saveBtn = document.getElementById('save-settings');
    if (saveBtn) {
        saveBtn.addEventListener('click', saveNotificationSettings);
    }
    
    // Load saved categories when on affirmations page
    if (document.getElementById('affirmations-page')) {
        loadSavedCategories();
    }
});

function saveNotificationSettings() {
    // FIX: Get selected categories from DOM instead of localStorage
    const selectedCards = document.querySelectorAll('.category-card.selected');
    const selectedCategories = Array.from(selectedCards).map(card => card.dataset.category);
    
    if (selectedCategories.length === 0) {
        showMessage('⚠️ Please select at least one category first!');
        return;
    }
    
    // Get selected days
    const selectedDays = [];
    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
        if (document.getElementById(`day-${day}`).checked) {
            selectedDays.push(day);
        }
    });
    
    if (selectedDays.length === 0) {
        showMessage('⚠️ Please select at least one day!');
        return;
    }
    
    const frequency = document.getElementById('frequency-select').value;
    const startTime = document.getElementById('start-time').value;
    
    // Save notification settings
    const notificationSettings = {
        categories: selectedCategories,
        days: selectedDays,
        frequency: parseInt(frequency),
        startTime: startTime,
        enabled: true,
        createdAt: new Date().toISOString()
    };
    
    localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
    
    // Create affirmation entries for each category
    selectedCategories.forEach(category => {
        saveAffirmationSetting(category, `Daily ${category} affirmation`, `${selectedDays.join(', ')} at ${startTime}`);
    });
    
    // Hide all UI elements after save
    document.querySelector('.notification-setup').style.display = 'none';
    document.querySelector('.setup-button-container').style.display = 'none';
    document.querySelector('.selected-categories').style.display = 'none';
    
    // Clear all selections visually
    document.querySelectorAll('.category-card.selected').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.checkbox').classList.remove('checked');
    });
    
    // Show success message IN FRONT
showMessage('🔔 Notification settings saved successfully!');
 }

function showSchedulePreview(settings) {
    const preview = document.getElementById('schedule-preview');
    const content = document.getElementById('preview-content');
    
    const timeSlots = [];
    const startHour = parseInt(settings.startTime.split(':')[0]);
    
    for (let i = 0; i < Math.floor(12 / settings.frequency); i++) {
        const hour = (startHour + (i * settings.frequency)) % 24;
        timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
    }
    
    content.innerHTML = `
        <div class="preview-item">
            <strong>Days:</strong> ${settings.days.join(', ')}
        </div>
        <div class="preview-item">
            <strong>Times:</strong> ${timeSlots.join(', ')}
        </div>
        <div class="preview-item">
            <strong>Categories:</strong> ${settings.categories.length} selected
        </div>
        <div class="preview-item">
            <strong>Daily Affirmations:</strong> ~${timeSlots.length} per day
        </div>
    `;
    
    preview.style.display = 'block';
}

// Utility Functions
function showMessage(message) {
    // Remove existing messages
    const existing = document.querySelector('.success-message');
    if (existing) existing.remove();
    
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message';
    messageDiv.textContent = message;
    
    // Apply inline styles directly
    messageDiv.style.cssText = `
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        z-index: 99999 !important;
        background: linear-gradient(135deg, #ccae79 0%, #caafe0 100%) !important;
        color: white !important;
        padding: 20px 30px !important;
        border-radius: 15px !important;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3) !important;
        font-size: 18px !important;
        font-weight: bold !important;
        text-align: center !important;
        min-width: 320px !important;
        border: 2px solid rgba(255,255,255,0.2) !important;
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        if (messageDiv.parentNode) {
            messageDiv.remove();
        }
    }, 3000);
}


function initializeProfile() {
    // Load saved profile image
    const savedImage = localStorage.getItem('profileImage');
    const profileImg = document.getElementById('profile-image');
    if (savedImage && profileImg) {
        profileImg.src = savedImage;
    }
    
    // Initialize first use date if not set
    if (!localStorage.getItem('firstUseDate')) {
        localStorage.setItem('firstUseDate', new Date().toISOString());
    }
    
    // Load existing data
    loadMeditationProgress();
    loadAffirmationSettings();
}

// Your existing functions (enhanced)
function loadMeditationProgress() {
    const totalMinutes = parseInt(localStorage.getItem('totalMeditationMinutes') || '0');
    const totalSessions = parseInt(localStorage.getItem('totalMeditationSessions') || '0');
    const totalHours = Math.floor(totalMinutes / 60);
    
    // Update elements if they exist
    const minutesEl = document.getElementById('meditation-minutes');
    const hoursEl = document.getElementById('meditation-hours');
    const sessionsEl = document.getElementById('meditation-sessions');
    
    if (minutesEl) minutesEl.textContent = totalMinutes;
    if (hoursEl) hoursEl.textContent = totalHours;
    if (sessionsEl) sessionsEl.textContent = totalSessions;
}

function updateMeditationProgress(minutes) {
    const currentMinutes = parseInt(localStorage.getItem('totalMeditationMinutes') || '0');
    const currentSessions = parseInt(localStorage.getItem('totalMeditationSessions') || '0');
    
    localStorage.setItem('totalMeditationMinutes', (currentMinutes + minutes).toString());
    localStorage.setItem('totalMeditationSessions', (currentSessions + 1).toString());
    
    console.log(`Meditation progress updated: +${minutes} minutes`);
    loadMeditationProgress(); // Refresh display
}

function loadAffirmationSettings() {
    const affirmations = JSON.parse(localStorage.getItem('scheduledAffirmations') || '[]');
    const affirmationList = document.getElementById('affirmation-list');
    const noAffirmations = document.getElementById('no-affirmations');
    
    if (!affirmationList) return; // Element doesn't exist on this page
    
    if (affirmations.length === 0) {
        affirmationList.style.display = 'none';
        if (noAffirmations) noAffirmations.style.display = 'block';
        return;
    }
    
    affirmationList.style.display = 'block';
    if (noAffirmations) noAffirmations.style.display = 'none';
    
    affirmationList.innerHTML = affirmations.map(affirmation => `
        <div class="affirmation-item">
            <div class="affirmation-category">${affirmation.category}</div>
            <div class="affirmation-text">"${affirmation.text}"</div>
            <div class="affirmation-schedule">
                <span>⏰</span>
                <span>${affirmation.schedule || 'Daily reminder set'}</span>
            </div>
        </div>
    `).join('');
}

function saveAffirmationSetting(category, text, schedule) {
    const affirmations = JSON.parse(localStorage.getItem('scheduledAffirmations') || '[]');
    
    const existingIndex = affirmations.findIndex(a => a.category === category);
    
    if (existingIndex >= 0) {
        affirmations[existingIndex] = { category, text, schedule };
    } else {
        affirmations.push({ category, text, schedule });
    }
    
    localStorage.setItem('scheduledAffirmations', JSON.stringify(affirmations));
    console.log('Affirmation setting saved:', { category, text, schedule });
    loadAffirmationSettings(); // Refresh display
}

// Add these functions to connect with your meditation player
function onMeditationComplete() {
    // Call this when your meditation audio/timer finishes
    completeMeditation();
}

// For manual completion (if user stops early)
function markMeditationComplete(meditationType) {
    trackMeditationCompletion(meditationType);
}
// Add this to your complete integration

// PWA Notification Functions
async function requestNotificationPermission() {
  if (!('Notification' in window)) {
    showMessage('❌ This browser does not support notifications');
    return false;
  }

  if (Notification.permission === 'granted') {
    await getFcmToken();
    return true;
  }

  if (Notification.permission !== 'denied') {
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      await getFcmToken();
      return true;
    }
  }

  return false;
}


function showNotificationModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.id = 'notification-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔔 Notification Settings</h3>
                <button class="close-modal" onclick="closeNotificationModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #fff;">×</button>

            </div>
            <div class="notification-settings">
                <!-- Notification Toggle -->
                <div class="notification-toggle-section">
                    <h4>📱 Push Notifications</h4>
                    <div class="toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifications-enabled" onchange="toggleNotifications()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="notification-status">Enable notifications to receive daily affirmations</span>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <h4>✨ Selected Affirmation Categories</h4>
                <div id="selected-categories-display"></div>
                <button onclick="selectAffirmationCategories()" 
                
                <div class="divider"></div>
                
                <h4>🧘 Meditation Progress</h4>
                <div class="progress-stats">
                    <p>Total Hours: <span id="profile-meditation-hours">0</span></p>
                    <p>Sessions: <span id="profile-meditation-sessions">0</span></p>
                    <p>Favorite Type: <span id="favorite-meditation">Not set</span></p>
                </div>
                
                <h4>📊 Your Activity</h4>
                <div class="progress-stats">
                    <p>Active Affirmations: <span id="active-affirmations-count">0</span></p>
                    <p>Saved Wishes: <span id="saved-wishes-count">0</span></p>
                    <p>Days Active: <span id="days-active">0</span></p>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    loadNotificationSettings();
}

async function toggleNotifications() {
    const toggle = document.getElementById('notifications-enabled');
    const status = document.getElementById('notification-status');
    
    if (toggle.checked) {
        const granted = await requestNotificationPermission();
        if (granted) {
            localStorage.setItem('notificationsEnabled', 'true');
            status.textContent = '✅ Notifications enabled! You\'ll receive daily affirmations';
            startNotificationSchedule();
        } else {
            toggle.checked = false;
            status.textContent = '❌ Permission denied. Enable in browser settings';
        }
    } else {
        localStorage.setItem('notificationsEnabled', 'false');
        status.textContent = 'Enable notifications to receive daily affirmations';
        stopNotificationSchedule();
    }
}

function startNotificationSchedule() {
    const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
    if (!settings.enabled || !settings.categories) return;
    
    // Clear existing intervals
    stopNotificationSchedule();
    
    // Create notification schedule
    const intervalId = setInterval(() => {
        sendRandomAffirmation();
    }, settings.frequency * 60 * 60 * 1000); // Convert hours to milliseconds
    
    localStorage.setItem('notificationIntervalId', intervalId);
}

function stopNotificationSchedule() {
    const intervalId = localStorage.getItem('notificationIntervalId');
    if (intervalId) {
        clearInterval(parseInt(intervalId));
        localStorage.removeItem('notificationIntervalId');
    }
}

function sendRandomAffirmation() {
    const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
    const affirmations = getAffirmationsByCategories(settings.categories);
    
    if (affirmations.length > 0 && Notification.permission === 'granted') {
        const randomAffirmation = affirmations[Math.floor(Math.random() * affirmations.length)];
        
        new Notification('✨ Daily Affirmation', {
            body: randomAffirmation.text,
            icon: '/icon-192x192.png', // Your PWA icon
            badge: '/icon-192x192.png',
            tag: 'daily-affirmation',
            requireInteraction: false
        });
    }
}

function getAffirmationsByCategories(categories) {
    // You'll need to create an affirmations database
    const affirmationsDB = {
        'Think Positively': [
            { text: 'I choose to see the good in every situation', category: 'Think Positively' },
            { text: 'My thoughts create my reality, and I choose positive thoughts', category: 'Think Positively' },
            { text: 'I am in control of my mindset and choose optimism', category: 'Think Positively' }
        ],
        'Build Self-Confidence': [
            { text: 'I believe in myself and my abilities', category: 'Build Self-Confidence' },
            { text: 'I am worthy of success and happiness', category: 'Build Self-Confidence' },
            { text: 'My confidence grows stronger every day', category: 'Build Self-Confidence' }
        ],
        // Add more categories and affirmations...
    };
    
    let allAffirmations = [];
    categories.forEach(category => {
        if (affirmationsDB[category]) {
            allAffirmations = allAffirmations.concat(affirmationsDB[category]);
        }
    });
    
    return allAffirmations;
}

function openWishesModal() {
    closeProfileMenu(); // Close the profile menu first
    const modal = document.getElementById('wishes-modal');
    modal.classList.remove('hidden'); // Show the wishes modal
}

function saveWish() {
    const wishText = document.getElementById('wishes-text').value;
    if (wishText.trim()) {
        const wishes = JSON.parse(localStorage.getItem('wishes') || '[]');
        wishes.push({
            text: wishText,
            date: new Date().toLocaleDateString()
        });
        localStorage.setItem('wishes', JSON.stringify(wishes));
        document.getElementById('wishes-text').value = '';
        
        // Simple beautiful notification - just replace the alert line
        const div = document.createElement('div');
div.innerHTML = '✨ Wish saved!';
div.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#ccae79;color:white;padding:15px;border-radius:10px;z-index:9999;text-align:center;';

        document.body.appendChild(div);
        setTimeout(() => div.remove(), 2000);
        
    } else {
        alert('Please write something first!');
    }
}


function viewSavedWishes() {
    const wishes = JSON.parse(localStorage.getItem('wishes') || '[]');
    
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:2000'; // Higher z-index
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.cssText = 'background:white;border-radius:20px;padding:20px;max-width:360px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.3)';

    
    // Create header
    const header = document.createElement('div');
    header.innerHTML = `
        <h3 style="margin:0 0 20px 0;color:#333">✨ Your Saved Wishes</h3>
        <button onclick="this.closest('[style*=fixed]').remove()" style="position:absolute;top:15px;right:20px;background:none;border:none;font-size:24px;cursor:pointer;color:#666">×</button>
    `;
    content.appendChild(header);
    
    // Create wishes list
    const wishesContainer = document.createElement('div');
    if (wishes.length === 0) {
        wishesContainer.innerHTML = '<p style="text-align:center;color:#666;font-style:italic;padding:40px">No wishes saved yet!</p>';
    } else {
        wishes.forEach((wish, index) => {
            const wishDiv = document.createElement('div');
            wishDiv.style.cssText = 'padding:15px;margin:10px 0;background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);border-radius:12px;border-left:4px solid #ccae79';
            wishDiv.innerHTML = `
                <div style="font-size:12px;color:#666;margin-bottom:8px">${wish.date}</div>
                <div style="font-size:16px;line-height:1.5;color:#333;font-weight:500">${wish.text}</div>
            `;
            wishesContainer.appendChild(wishDiv);
        });
    }
    
    content.appendChild(wishesContainer);
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Close when clicking outside
    modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
    };
}

function openFreeResources() {
    window.open('https://payhip.com/KarmaDecoded/collection/free-resources', '_blank');
}

function showMainApp() {
  console.log('=== showMainApp called ===');
  const authScreen = document.getElementById('auth-screen');
  const mainApp = document.getElementById('main-app');
  
  console.log('auth-screen found:', !!authScreen);
  console.log('main-app found:', !!mainApp);
  
  if (authScreen) {
    authScreen.style.display = 'none';
    console.log('auth-screen hidden');
  }
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('main-app shown');
  }
  
  console.log('=== showMainApp finished ===');
}

// Add the new URL parameter detection here
window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('page') === 'recent-affirmations') {
        openRecentAffirmations();
    }
});

    navigator.serviceWorker.addEventListener('message', (event) => {
  if (event.data && event.data.command === 'openRecentAffirmations') {
    openRecentAffirmations();
  }
});




</script>
</body>
</html>
